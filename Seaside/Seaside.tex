% $Author: oscar $
% $Date: 2009-08-17 00:11:18 +0600 (пн, 17 авг 2009) $
% $Revision: 28482 $
% $Id: Seaside.tex 28482 2009-08-16 18:11:18Z oscar $

% HISTORY:
% 2007-10-29 - Oscar started chapter
% 2007-11-30 - Oscar first draft
% 2007-12-07 - Orla Greevy reviewed
% 2007-12-09 - Lukas Renggli reviewed
% 2008-01-11 - Andrew revised
% 2009-04-17 - Fabrizio Perin reviewed
% 2009-04-18 - Jorge Ressia reviewed
% 2009-05-06 - Oscar converted to Pharo; fixed review comments

%=================================================================
\ifx\wholebook\relax\else
% --------------------------------------------
% Lulu:
	\documentclass[a4paper,10pt,twoside]{book}
	\usepackage[
		papersize={6.13in,9.21in},
		hmargin={.75in,.75in},
		vmargin={.75in,1in},
		ignoreheadfoot
	]{geometry}
	\input{../common.tex}
	\pagestyle{headings}
	\setboolean{lulu}{true}
% --------------------------------------------
% A4:
%	\documentclass[a4paper,11pt,twoside]{book}
%	\input{../co	mmon.tex}
%	\usepackage{a4wide}
% --------------------------------------------
    \graphicspath{{figures/} {../figures/}}
	\begin{document}
	% \renewcommand{\nnbb}[2]{} % Disable editorial comments
	\sloppy
\fi
%=================================================================

%\chapter{Seaside by Example}
\chapter{Seaside в примерах}

%\chalabel{seaside}
\chalabel{seaside}

%=================================================================

% \ind{Seaside} is a framework for building web applications in Smalltalk. It was
% originally developed by Avi Bryant \index{Bryant, Avi} in 2002; once mastered, Seaside
% makes web applications almost as easy to write as desktop applications.

\ind{Seaside} -- фреймворк для создания веб-приложений в Smalltalk.
Был разработан Avi Bryant \index{Bryant, Avi} в 2002 году.
После освоения, Seaside позволяет писать веб-приложения так же легко
как и стандартные приложения.

% Two of the better known applications built with Seaside are
% \ind{SqueakSource}\footnote{\url{http://SqueakSource.com}} and \ind{Dabble
% DB}\footnote{\url{http://DabbleDB.com}}.
% Seaside is unusual in that it is thoroughly object-oriented: there are no XHTML
% templates, no complicated control flows through web pages, and no encoding of state in
% URLs. Instead, you just send messages to objects. What a nice idea!

Наиболее известные приложения построенные при помощи \hbox{Seaside}
\,---\,\ind{SqueakSource}\footnote{\url{http://SqueakSource.com}}
и \ind{Dabble DB}\footnote{\url{http://DabbleDb.com}}.
Необычность Seaside заключается в том, что он является чисто
объектно-ориентированным: отсутствуют XHTML шаблоны,
нет сложного управления через веб-страницы,
отсутствует человокочитабельный URL.
Вместо этого можно отправлять сообщения объектам.
Вот в чем главная идея!

% \section{Why do we need Seaside?}
\section{Почему нам нужен Seaside?}

% Modern web applications try to interact with the user in the same way as desktop
% applications: they ask the user questions and the user responds, usually by filling in a
% form or clicking a button.
% But the web works the other way around: the user's browser makes a request of the server,and the server responds with a new web page.
% So \ind{web application development} frameworks have to cope with a host of problems,
% chief among them being the management of this ``inverted'' control flow.
% Because of this, many web applications try to forbid the use of the browser's ``back''
% button due to the difficulty of keeping track of the state of a session.
% Expressing non-trivial control flows across multiple web pages is often cumbersome, and
% multiple control flows can be difficult or impossible to express.

Современные веб-приложения взаимодействуют с пользователем
и ведут себя как обычные приложения:
они обращаются к пользователю с вопросами и отвечают на его запросы,
используя при этом формы или нажатия на кнопки.
Но работа в сети имеет и другие стороны: браузер пользователя делает
запросы к серверу, и получает от него ответ в виде веб-страницы.
Так \ind{среды разработки приложений} должны справляться со множеством
проблем, где главной проблемой является управление
<<обратными>> потоками.
Из-за этого многие приложения пытаются запретить использование
кнопки <<предыдущая страница>> у браузера,
чтобы не усложнять текущее состояние сессии.
Управление тривиальными потоками через несколько веб-страниц
часто бывает громоздко,
а управление множеством потоков становится сложным или невозможным.

% Seaside is a component-based framework that uses ``\ind{continuations}''\footnote{A
% \emph{continuation} represents ''the rest of the computation'' at any point in a
% computation. In Smalltalk, a continuation is just an object that captures the current
% state of the computation, and which can be resumed at any point. to keep track of
% multiple points in the control flow of web applications. Continuations are managed
% automatically by Seaside, so web developers do not even have to be aware of the
% underlying machinery. It just works.

Seaside\,---\,компонентно-ориентированный фреймворк, который использует
\emph{продолжения}, представляющие собой <<остаточные вычисления>>
в какой-либо точке.
В Smalltalk, продолжением является объект,
который запоминает текущее состояние вычислений,
и позволяет вернуться в любую точку. Продолжения управляются в
Seaside автоматически, что даже веб-разработчику не надо быть в курсе
их основных механизмов. И это работает.
\index{Seaside!транзакции}
\index{Seaside!компоненты}

% Seaside is a component-based framework that makes web development easier in several
% ways.First, control flow can be expressed naturally using message sends.
% Seaside keeps track of which web page corresponds to which point in the execution of the
% web application.
% This means that the browser's ``back'' button works correctly.

Seaside\,---\,фреймворк, который делает веб разработку проще в нескольких 
случаях.
Во-первых и управление потоком может быть выражено через посылку
сообщений. Также Seaside отслеживает соответствие веб-страницы точке
исполнения веб-приложения. Это означает, что кнопка браузера <<назад>>
будет работать корректно.


% Second, state is managed for you.
% As the developer, you have the choice of enabling 
% backtracking of state, so that navigation ``back'' in time will undo side-effects.
% Alternatively, you can use the transaction support built into Seaside to prevent users
% from undoing permanent side-effects when they use the back button.
% You do not have to encode state information in the URL\,---\,this too is managed
% automatically for you.

Во-вторых, состояние может быть управляемо вами.
Как разработчик, вы можете разрешить возврат к предыдущему состоянию
используя кнопку <<назад>>, чтобы отменить ошибочные действия.
В качестве альтернативы, можно использовать механизм транзакций,
встроенный в Seaside,
чтобы защитить пользователя от нежелательных побочных эффектов,
при нажатии на кнопку <<назад>>.
Также не нужно кодировать информацию в URL адресе, все это уже автоматизированно для вас.

% Third, web pages are built up from nested components, each of which can support its own,
% independent control flow.
% There are no XHTML templates\,---\,instead valid XHTML is generated programmatically
% using a simple Smalltalk protocol.
% Seaside supports Cascading Style Sheets (\ind{CSS}), so content and layout are cleanly
% separated.
% \seeindex{Cascading Style Sheets}{CSS}

В третьих, веб-страницы построены из вложенных компонентов,
каждый из которых может поддерживать свое собственное,
независимое управление потоком.
Отсутствуют временные шаблоны XHTML,
вместо это XHTML генерируется программно,
используя простой Smalltalk протокол.
Seaside поддерживает Таблицы каскадных стилей (\ind{CSS}),
так как содержимое и оформление страницы разделены.
\seeindex{Таблица каскадных стилей}{CSS}

% Finally, Seaside provides a convenient web-based development interface, making it easy todevelop applications iteratively, debug applications interactively, and recompile and
% extend applications while the server is running.

И в заключении, Seaside обеспечивает удобный веб интерфейс среды,
позволяющей интерактивно отлаживать приложение, рекомпилировать,
и расширять, когда сервер запущен.

%=================================================================
% \section{Getting started}

\section{Начало работы с Seaside}

% The easiest way to get started is to download the ``Seaside \subind{Seaside}{One-Click
% Experience}'' from the Seaside \subind{Seaside}{web
% site}\footnote{\url{http://seaside.st}}.
% This is a prepackaged version of Seaside 2.8 for \ind{Mac OSX}, \ind{Linux} and
% \ind{Windows}.
% The same web site lists many pointers to additional resources, including documentation
% and tutorials.
% Be warned, however, that Seaside has evolved considerably over the years, and not all
% available material refers to the latest version of Seaside.

Самый простой путь, чтобы начать - это загрузить Seaside
\subind{Seaside}{One-Click Experience} с веб-сайта Seaside \footnote{\url{http://seaside.st}}.
Это версия Seaside 2.8 для \ind{Mac OSX}, \ind{Linux} и \ind{Windows}.
На этом же сайте много ссылок на дополнительные ресурсы, включающие документацию и руководства.
Необходимо иметь в виду, что Seaside претерпела значительные изменения на протяжении ряда лет,
и не все имеющиеся материалы относятся к последней версии Seaside.

% If you are feeling more adventurous, an alternative to the ``one-click'' image is to
% start with the latest \ind{\pharo web
% image}\footnote{\url{http://pharo-project.org/download}}, and install Seaside yourself byfollowing the manual \subind{Seaside}{installation} instructions on the Seaside web site.
% Seaside includes a web server; you can turn the server on, telling it to listen on port
% 8080, by evaluating \clsind{WAKom} \ct{startOn: 8080},
% and you can turn it off again by evaluating \ct{WAKom stop}.
% In the default installation, the default \subind{Seaside}{administrator login} is
% \lct{admin} and the default password is \lct{seaside}.
% To change them, evaluate: \clsind{WADispatcherEditor} \ct{initialize}.
% This will prompt you for a new name and password.

Если вы считаете себя продвинутым пользователем,
то в качестве альтернативы можно использовать <<one-click>> образ
с последнего
\ind{\pharo веб-образа}\footnote{\url{http://pharo-project.org/download}},
и установить Seaside самому, следуя руководству
\subind{Seaside}{installation} на Seaside веб сайте.
Seaside включает в себя веб сервер;
его можно запустить на прослушивание порта 8080,
выполнив \clsind{WAKom} \ct{startOn: 8080},
а можно и остановить, выполнив \ct{WAKom stop}.
После установки, по умолчанию,
\subind{Seaside}{логин администратора} -- \lct{admin} и пароль -- \lct{seaside}.
Чтобы изменить, нужно выполнить: \clsind{WADispatcherEditor} \ct{initialize}.
И ввести необходимые имя и пароль.


\begin{figure}[tbh]
\begin{center}
\includegraphics[width=\textwidth]{seasideStartup}

% \caption{Starting up Seaside}
\caption{Запуск Seaside}

\figlabel{seasideStartup}
\end{center}
\end{figure}

% \dothis{Start the Seaside server and direct a web browser to
% \url{http://localhost:8080/seaside/}.}
\dothis{Запустите Seaside сервер и откройте через веб-браузер \url{http://localhost:8080/seaside/}.}

\noindent
% You should see a web page that looks like \figref{seasideStartup}.
Открывшаяся веб-страница будет выглядеть как на \figref{seasideStartup}.

\noindent
% \dothis{Navigate to the \lct{examples{\go}counter} page. (\figref{counter})}
\dothis{Перейдите по ссылкам \lct{examples}{\go}counter. (\figref{counter})}

\begin{figure}[htb]
\begin{center}
\includegraphics[width=0.8\textwidth]{counter}
\caption{Счетчик (The counter).}
\figlabel{counter}
\end{center}
\end{figure}

\noindent
% This page is a small Seaside application: it displays a \subind{Seaside}{counter} that
% can be incremented or decremented by clicking on the \link{++} and \link{--\,--} links.

Эта страница является небольшим Seaside приложением,
в котором значение счетчика можно изменять,
щелкая по ссылкам \link{++} и \link{--}.

% \noindent
% \dothis{Play with the counter by clicking on these links.
% Use your browser's ``back'' button to go back to a previous state, and then click on
% \link{++} again.
% Notice how the counter is correctly incremented with respect to the currently displayed
% state, rather than the state that the counter was in when you started using the ``back''
% button.}

\noindent
Проверьте как работает приложение, щелкая по ссылкам на странице.
Далее нажмите кнопку браузера <<назад>>,
чтобы просмотреть предыдущую страницу,
и щелкните по ссылке \link{++}.
Стоит обратить внимание,
что увеличение счетчика происходит правильно по отношению к
отображаемому числу, а не к числу до использования кнопки <<назад>>.

% Notice the \subind{Seaside}{toolbar} at the bottom of the web page in
% \figref{seasideStartup}.
% Seaside supports a notion of ``sessions'' to keep track of the state of the application
% for different users.
% \button{New Session} will start a new session on the counter application.
% \button{Configure} allows you to configure the settings of your application through a
% convenient web-interface.
% (To close the \button{Configure} view, click on the \link{x} in the top right corner.)
% \button{Toggle Halos} provides a way to explore the state of the application running on
% the Seaside server.
% \button{Profiler} and \button{Memory} provide detailed information about the run-time
% performance of the application.
% \button{XHTML} can be used to validate the generated web page, but works only when the
% web page is publicly accessible from the Internet, because it uses the W3C validation
% service.
% \index{Seaside!halos}

Внизу окна расположена панель инструментов,
которую видно на \figref{seasideStartup}.
Seaside поддерживает сессии пользователя,
хранящие состояния приложения для различных пользователей.
\button{New Session} начинает новую сессию.
\button{Configure} конфигурирует настройки вашего приложения
через удобный веб интерфейс.
(Чтобы закрыть окно \button{configure} щелкните по ссылке \link{x}
которая расположена в правом верхнем углу.)
\button{Toggle Halos} обеспечивает возможность просмотра
состояние активного приложения на Seaside сервере.
\button{Profiler} и \button{Memory} детализируют информацию о
производительности и потребляемой памяти.
\button{XHTML} может быть использовано для веб страниц, которые опубликованы в Интернете, так как используется сервис проверки W3C.
\index{Seaside!halos}


% Seaside applications are built up from pluggable ``components''.
% In fact, components are ordinary Smalltalk objects.
% The only thing that is special about them is that they should be instances of classes
% that inherit from the Seaside framework class \ct{WAComponent}.
% We can explore components and their classes from the \pharo image, or directly from the
% web interface using halos.

Seaside-приложение создается из подключаемых <<компонентов>>.
Фактически, компонентами являются Smalltalk объекты.
Только одно важное условие должно соблюдаться для них\,---\,все должны
быть экземплярами класса,
который наследует \ct{WAComponent}.
Есть возможность просматривать экземпляры и других классов,
расположенных в \pharo образе.

\begin{figure}[ht]
\begin{center}
\includegraphics[width=\textwidth]{counterHalos}
\caption{Halos}
\figlabel{counterHalos}
\end{center}
\end{figure}

% \dothis{Select \button{Toggle Halos}. You should see a web page like
% \figref{counterHalos}.
% At the top left the text \ct{WACounter} tells us the class of the Seaside component that
% implements the behavior of this web page.
% Next to this are three clickable icons. 
% The first, with the pencil, activates a Seaside class browser on this class.
% The second, with the magnifying glass, opens an object inspector on the currently active
% \ct{WACounter} instance.
% The third, with the coloured circles, displays the \ind{CSS} style sheet for this
% component.
% At the top right, the \link{R} and \link{S} let you toggle between the rendered and
% source views of the web page.
% Experiment with all of these links. 
% Note that the \link{++} and \link{--} links are also active in the source view.
% Contrast the nicely-formatted source view provided by the Halos with the unformatted
% source view offered by your browser.}

\dothis{Выберите \button{Toggle Halos}. Откроется веб-страница как на
\figref{counterHalos}.
Слева вверху расположен текст \ct{WACounter}
говорящий нам  какой класс Seaside компонента осуществляет реализацию этой веб-страницы.
Далее расположены три ссылки в виде изображений.
Первая, с изображением карандаша, активизирует Seaside-классовый браузер.
Вторая, с изображением лупы, открывает объектный инспектор текущего
активного экземпляра.
Третья ссылка с цветными кругами показывает \ind{CSS}-стиль компонента.
В правой части, гиперссылки \link{R} и \link{S} позволяют просмотреть нам
готовую веб-страницу и в виде HTML-кода.
Поэкспериментируйте с этими ссылками.
Обратите внимание, что гиперссылки \link{++} и \link{- -} остаются активными
и в HTML-коде.
Красиво оформленный HTML-код показываемый в режиме Halos разительно отличается от представления кода браузером.}

% The Seaside class browser and object inspector can be very convenient when the server is
% running on another computer, especially when the server does not have a display, or if itis in remote place.
% However, when you are first developing a Seaside application, the server will be running
% locally, and it is easy to use the ordinary \pharo development tools in the server image.

Классовый браузер и объектный инспектор могут быть очень удобными,
когда сервер работает на другом компьютере,
в особенности когда сервер не имеет монитора или расположен
на удаленном месте.
Обычно, когда вы будете создавать первое Seaside-приложение,
сервер будет работать локально,
и проще использовать стандартный инструментарий образа.

\begin{figure}[ht]
\begin{center}
\includegraphics[width=0.7\textwidth]{haltingCounter}
\caption{Приостановленная сессия приложения Сounter}
\figlabel{haltingCounter}
\end{center}
\end{figure}

% \dothis{Using the object inspector link in the web browser, open an inspector on the
% underlying Smalltalk counter object and evaluate \ct{self halt}.
% The web page will stop loading.
% Now switch to the Seaside image.
% You should see a pre-debugger window (\figref{haltingCounter}) showing a \ct{WACounter}
% object executing a \ct{halt}.
% Examine this execution in the debugger, and then \button{Proceed}.
% Go back to the web browser and notice that the counter application is running again.}

\dothis{Используя ссылки объектного инспектора в веб-браузере,
откройте инспектор текущего объекта Smalltalk counter и выполните
\ct{self halt}.
Загрузка веб-страницы будет приостановлена.
Переключитесь на Seaside образ.
И в нем увидите отладочное окно (\figref{haltingCounter}) показывающее
обработку сообщения \ct{halt} экземпляром \ct{WACounter}.
Проверив выполнение в отладчике, далее нажмите \button{Proceed}.
Вернувшись обратно в браузер, земетьте,
что приложение продолжило свою работу.}

% Seaside components can be instantiated multiple times and in different contexts.

Seaside компоненты могут быть созданы много раз и в различных контекстах.

\begin{figure}[ht]
\begin{center}
\includegraphics[width=\textwidth]{multiCounterHalos}
\caption{Зависимость вложенных компонентов}
\figlabel{multiCounterHalos}
\end{center}
\end{figure}

% \dothis{Point your web browser to
% \url{http://localhost:8080/seaside/examples/multicounter}.
% You will see an application built out of a number of independent instances of the countercomponent.
% Increment and decrement several of the counters.
% Verify that they behave correctly even if you use the ``back'' button.
% Toggle the halos to see how the application is built out of nested components.
% Use the Seaside class browser to view the implementation of \ct{WAMultiCounter}.
% You should see three methods on the class side (\ct{canBeRoot}, \ct{description}, and
% \ct{initialize}) and three on the instance side (\ct{children}, \ct{initialize}, and
% \ct{renderContentOn:}).
% Note that an application is simply a component that is willing to be at the root of the
% component containment hierarchy; this willingness is indicated by defining a class-side
% method \ct{canBeRoot}
% to answer \ct{true}.}
% \index{Seaside!multi-counter}

\dothis{Откройте в браузере страницу
\url{http://localhost:8080/seaside/examples/multicounter}.
Вы увидите приложение,
которое построено на нескольких независимых экземплярах класса Counter.
Попробуйте увеличивать и уменьшать значение счетчиков.
Убедитесь, что счетчики работают корректно даже после использования
кнопки <<назад>>.
Переключите Halos,
чтобы увидеть как построено приложение из вложенных компонентов.
Воспользуйтесь классовым браузером Seaside,
и посмотрите реализацию \ct{WAMultiCounter}.
Вы увидите три метода на стороне класса (\ct{canBeRoot},
\ct{description}, и \ct{initialize}) и три на стороне экземпляра (\ct{children},
\ct{initialize}, и \ct{renderContentOn:}).
Заметье, что приложение является простым корневым компонентом,
содержащее вложенные элементы;
готовность быть основой (корнем) определяется методом \ct{canBeRoot},
который расположен на стороне класса и возвращает значение \ct{true}.}
\index{Seaside!multi-counter}

% You can use the Seaside web interface to configure, copy or remove individual
% applications (\ie root-level components). Try making the following configuration change.

Вы можете использовать веб-интерфейс Seaside, чтобы конфигурировать,
копировать или удалять индивидуальные приложения.
Попробуйте выполнить нижеследующие изменения конфигурации.

% \dothis{Point your web browser to \url{http://localhost:8080/seaside/config}.
% Supply the login and password (\ct{admin} and \ct{seaside} by default).
% Select \link{Configure} next to ``examples.''
% Under the heading ``Add entry point'', enter the new name ``counter2'' for the type
% \emph{Application} and click on \button{Add} (see \figref{counter2}).
% On the next screen, set the \emph{Root Component} to \clsind{WACounter}, then click
% \button{Save} and \button{Close}.
% Now we have a new counter installed at
% \url{http://localhost:8080/seaside/examples/counter2}.
% Use the same configuration interface to remove this entry point.}
% \index{Seaside!configuration}

\dothis{Перейдите на страницу \url{http://localhost:8080/seaside/config}.
Авторизуйтесь, введя логин и пароль (\ct{admin} и \ct{seaside} по умолчанию).
Выберите \link{Configure} и далее <<examples>>.
Под заголовком <<Add entry point>> (добавить входную точку),
введите новое имя <<counter2>>, выберите тип \emph{Application},
далее нажмите на кнопку \button{Add} (смотрите \figref{counter2}).
На следующем экране, установите опцию \emph{Root Component} на
\clsind{WACounter}, далее нажмите кнопки \button{Save} и \button{close}.
Теперь мы имеем новый счетчик расположенный в
\url{http://localhost:8080/seaside/examples/counter2}.
Для удаления этой входной точки используется этот же самый интерфейс конфигурации.}
\index{Seaside!Конфигурация}


\begin{figure}[ht]
\begin{center}
\includegraphics[width=\textwidth]{counter2}
\caption{Конфигурация нового приложения}
\figlabel{counter2}
\end{center}
\end{figure}

% Seaside operates in two modes: \emph{development} mode, which is what we have seen so
% far, and \emph{deployment} mode, in which the toolbar is not available.
% \index{Seaside!deployment mode}
% \index{Seaside!development mode}
% You can put Seaside into deployment mode using either the configuration page (navigate tothe entry for the application and click on the \link{Configure} link)
% % \ab{How?  I couldn't find this}
% or click the \button{Configure} button in the toolbar.
% In either case, set the deployment mode to \emph{true}.
% Note that this affects new sessions only.
% You can also set the mode globally by evaluating
% \clsind{WAGlobalConfiguration} \lct{setDeploymentMode}
% or
% \ct{WAGlobalConfiguration setDevelopmentMode}.
% \index{Seaside!deployment mode}
% \index{Seaside!development mode}

Seaside работает в двух режимах: \emph{development} (развиваемый),
который позволяет получить полный доступ и увидеть все,
и \emph{deployment} (развернутый, рабочий),
в котором панель инструментов не доступна.
\index{Seaside!deployment mode}
\index{Seaside!development mode}
Вы можете перевести Seaside в deployment-режим
используя страницу конфигурации или нажмите кнопку
\button{Configure} на панели инструментов.
В любом случае, установите deployment-режим на \emph{true}.
Заметьте, изменения появятся только для следующих новых сессий.
Также можете установить режим для всех компонентов, выполнив,
\clsind{WAGlobalConfiguration} \lct{setDeploymentMode} или
\ct{WAGlobalConfiguration setDevelopmentMode}.
\index{Seaside!развернутый (исполняемый) режим}
\index{Seaside!режим разработки}

% The configuration web page is just another Seaside application, so it too can be
% controlled from the configuration page.
% If you remove the ``config'' application, you can get it back by evaluating
% \clsind{WADispatcherEditor} \ct{initialize}.

Веб-страница конфигурации является Seaside-приложением, и его тоже можно управлять со страницы конфигурации.
Если вы удалите приложение <<config>>, то можете восстановить его выполнив, \clsind{WADispatcherEditor} \ct{initialize}.

%=================================================================
% \section{Seaside components}
% \seclabel{components}

\section{Seaside компоненты}
\seclabel{components}

% %\ab{This section was too long\,---\,18 pages. It also contained several self-references
% (``see section 1.3''). So I broke into smaller sections, by promoting some of the
% subsections and subsubsections.

% As we mentioned in the previous section, Seaside applications are built out of
% \emph{\subind{Seaside}{components}.}
% Let's take a closer look at how Seaside works by implementing the \emph{Hello World}
% component.

Как мы отмечали в предыдущей главе, Seaside-приложение строится из
Seaside-компонентов. Давайте посмотрим как работает Seaside внутри на
примере компонента \emph{Hello World}.

%Every Seaside component should inherit directly or indirectly from \clsind{WAComponent},
% as shown in \figref{WACounter}.

Каждый Seaside-компонент должен быть прямым или косвенным наследником \clsind{WACounter},
как показано на \figref{WACounter}.

% \dothis{Define a subclass of \ct{WAComponent} called \ct{WAHelloWorld}.}

\dothis{Создайте подкласс \ct{WAComponent} назвав его \ct{WAHelloWorld}.}

% Components must know how to render themselves.
% Usually this is done by implementing the method \mthind{WAPresenter}{renderContentOn:},
% which gets as its argument an instance of \clsind{WAHtmlCanvas}, which knows how to
% render XHTML.
% \index{Seaside!rendering}

Компоненты должны знать как отображать себя.
Обычно это реализовано в методе \mthind{WAPresenter}
{renderContentOn:},
который получает в качестве аргумента экземпляр \clsind{WAHtmlCanvas},
умеющий, в свою очередь, создавать XHTML.
\index{Seaside!отображение}


% \dothis{Implement the following method, and put it in a protocol called
% \prot{rendering}:}

Реализуйте нижерасположенный метод, который вызывается при создании веб-страницы.

\needlines{2}
\begin{code}{}
WAHelloWorld>>>renderContentOn: html
	html text: 'hello world'
\end{code}

% \noindent
% Now we must inform Seaside that this component is willing to be a standalone application.\dothis{Implement the following method on the class side of \ct{WAHelloWorld}.}

\noindent
Сейчас нам нужно информировать Seaside,
что этот компонет будет независимым приложением.

\dothis{Осуществите нижерасположенный метод на стороне класса \ct{WAHelloWorld}.}

\begin{code}{}
WAHelloWorld class>>>canBeRoot
	^ true
\end{code}

% \noindent
% We are almost done!

\noindent
Мы почти у цели!

% \dothis{Point your web browser at \url{http://localhost:8080/seaside/config}, add a new
% entry point called ``hello'', and set its root component to be \ct{WAHelloWorld}.
% Now point your browser to \url{http://localhost:8080/seaside/hello}.
% That's it!  You should see a web page like \figref{WAHelloWorld}.}

\dothis{Перейдите в обозревателе на страницу
\url{http://localhost:8080/seaside/config}, добавьте новую точку входа назвав ее
<<hello>>, далее установите в качестве корневого компонента
(root component) \ct{WAHelloWorld}.
Теперь откройте в обозревателе \url{http://localhost:8080/seaside/hello}.
Вот и все! Вы увидите веб-страницу как на \figref{WAHelloWorld}.}

\begin{figure}[htb]
\begin{center}
\includegraphics[width=\textwidth]{WAHelloWorld}
\caption{<<Hello World>> на Seaside}
\figlabel{WAHelloWorld}
\end{center}
\end{figure}

%-----------------------------------------------------------------
% \subsection{State backtracking and the ``Counter'' Application}
%{Simple and nested components}

\subsection{Предыдущие страницы и приложение <<Counter>>}

% The ``counter'' application is only slightly more complex than the ``hello world''
% application.
% \seclabel{backtracking}

Приложение <<counter>> немного сложнее чем <<hello world>>.
\seclabel{backtracking}

\begin{figure}[ht]
\begin{center}
\includegraphics[width=\textwidth]{WACounter}
% \caption{The \ct{WACounter} class, which implements the \emph{counter} application.
% Methods with underlined names are on the class-side; those with plain-text names are on
% the instance side.}
\caption{Класс \ct{WACounter}, который реализирует приложение
\emph{counter}.
Подчеркнутые методы расположены на стороне класса;
остальные на стороне экзепляра.}
\figlabel{WACounter}
\end{center}
\end{figure}

% The class \clsind{WACounter} is a standalone application, so \ct{WACounter class} must
% answer \ct{true} to the \mthind{WAComponent class}{canBeRoot} message.
% It must also register itself as an application; this is done in its class-side
% \ct{initialize} method, as shown in \figref{WACounter}.

Класс \clsind{WACounter}\,---\,независимое приложение, и поэтому класс 
\ct{WACounter} ответит \ct{true} на сообщение
\mthind{WAComponent class}{canBeRoot}.
Данный метод нужен при регистрации в качестве приложения;
все делается на стороне класса в методе \ct{initialize}, показано на \figref{WACounter}.

% \ct{WACounter} defines two methods, \ct{increase} and \ct{decrease}, which will be
% triggered from the \link{++} and \link{--\,--} links on the web page.
% It also defines an instance variable \ct{count} to record the state of the counter.
% However, we also want Seaside to synchronize the counter with the browser page:
% when the user clicks on the browser's ``back'' button, we want seaside to ``backtrack''
% the state of the \ct{WACounter} object.
% Seaside includes a general mechanism for backtracking, but each application has to tell
% Seaside which parts of its state to track.

\ct{WACounter} определяет два метода, \ct{increase} и \ct{decrease},
которые срабатывают при переходе по ссылкам \link{++} и \link{--\,--}
на веб-странице.
Также определена переменная экземпляра \ct{count},
чтобы записывать состояние <<counter>>.
И еще мы хотим, чтобы Seaside синхронизировал <<counter>>
с веб-страницей: когда пользователь нажмет в браузере кнопку <<назад>>,
нам нужно чтобы Seaside переводил в правильное состояние
объект \ct{WACounter}.
Seaside включает в себя механизм восстановления предыдущих
состояний объекта, и каждое приложение может сообщить Seaside,
какие части требуется восстановить.

% A component enables backtracking by implementing the \ct{states} method on the instance
% side:
% % \ab{note that xspace messes up again, by inserting a space at the start of this line}
% \ct{states} should answer an array containing all the objects to be tracked.
% In this case, the \ct{WACounter} object adds itself to Seaside's table of backtrackable
% objects by returning \ct{Array with: self}.

Компонент разрешает возврат в предыдущее состояние реализацией
метода \ct{states} на стороне экземпляра.
Метод \ct{states} должен возвращать массив,
содержащий все объекты предыдущего состояния. В нашем случае,
объект \ct{WACounter} добавляет самого себя в таблицу предыдущих
состояний, возвращая \ct{Array with: self}.

% \paragraph{\emph{Caveat.}}
% There is a subtle but important point to watch for when declaring objects for
% backtracking.
% Seaside tracks state by making a \emph{copy} of all the objects declared in the
% \ct{states} array.
% It does this using a \clsind{WASnapshot} object; \ct{WASnapshot} is a subclass of
% \clsind{IdentityDictionary} that records the objects to be tracked as keys and shallow
% copies of their state as values.
% If the state of an application is backtracked to a particular snapshot,
% the state of eachobject entered into the snapshot dictionary
% is overwritten by the copy saved in the snapshot.

\emph{Предостережение.}
Обратим внимание на малозаметный, но важный нюанс,
для объектов сохраняющих прежние состояния.
Seaside отслеживает состояния, созданием копий всех объектов размещенных в массиве \ct{states}.
Используется объект \clsind{WASnapshot}; являющийся подклассом \clsind{IdentityDictionary},
который записывает объекты в виде ключа и поверхностной копии (shallow) объекта в виде значения.
Если состояние приложения было востановлено из прежней копии,
то состояние каждого объекта входящего в словарь сохраненных объектов
будет переписано.

% Here is the point to watch out for:
% In the case of \ct{WACounter}, you might think that the state to be tracked is a
% number\,---\,the value of the \ct{count} instance variable.
% However, having the \ct{states} method answer \ct{Array with: count} won't work.  
% This is because the object named by \ct{count} is an integer, and integers are
% immutable.The \ct{increase} and \ct{decrease} methods don't change the state of the
% object \ct{0}
% into \ct{1} or the object \ct{3} into \ct{2}.
% Instead, they make \ct{count} name a different integer: 
% every time the count is incremented or decremented, the object named by \ct{count} is
% \emph{replaced} by another.
% This is why \ct{WACounter>>>states} must return \ct{Array with: self}.
% When the state of a \mbox{\ct{WACounter}} object is replaced by a previous state, the
% \emph{value} of each of the instance variable in the object is replaced by a previous
% value; this correctly replaces the current value of \ct{count} by a prior value.
% \index{Seaside!backtracking state}
% \index{WAPresenter!states@\ct{states}}

Важное замечание, чтобы не упустить:
В случае приложения \ct{WACounter}, Вам нужно подумать чтобы в
отслеживаемом состоянии запоминалось число\,---\,значение переменной
экзепляра \ct{count}.
Однако, будет ошибочно, если метод \ct{states} ответит \ct{Array with: count}.
Потому что переменная count содержит целочисленное число, которое
неизменяемо. Методы \ct{incease} и \ct{decrease} не изменят состояние
объекта \ct{0} на \ct{1}, \ct{2} или \ct{3}.
Это означает, что метод \ct{WACounter>>>states} должен возвращать
\ct{Array with: self}.
\index{Seaside!отслеживание предыдущего состояния объекта}
\index{WAPresenter!states@\ct{states}}


% \section{Rendering XHTML}
\section{Создание XHTML}

% The purpose of a web application is to create, or ``render'', web pages. As we mentioned
% in \secref{components}, each Seaside component is responsible for rendering itself.
% So, lets start our exploration of rendering by seeing how the counter component renders
% itself.

Назначением веб-приложения является создание (или прорисовка) веб-страницы.
Как мы уже упоминали в \secref{components},
каждый Seaside компонент имеет возможность прорисовывать (отражать) себя на веб-страницу.
Итак, давайте начнем наше изучение на примере компонента counter.

%\subsection{Rendering the Counter}
\subsection{Отображение компонента Counter}

% The rendering of the counter is relatively straightforward; the code is shown in
% \figref{WACounter}.
% The current value of the counter is displayed as an XHTML heading, and the increment and
% decrement operations are implemented as html anchors (that is, links) with callbacks to
% blocks that will send \ct{increase} and \ct{decrease} to the counter object.

Отражение на веб-страницу объекта counter достаточно простое; код показан на \figref{WACounter}.
Текущее значение counter показывается в качестве XHTML-заголовка,
а шаговое увеличение (уменьшение) реализовано гиперссылками с
блоками обратного вызова,
которые посылают сообщения \ct{increase} и \ct{decrease} объекту counter.

% We will have a closer look at the rendering protocol in a moment.
% But before we do, let's have a quick look at the \subind{Seaside}{multi-counter}.

Мы будем подробно рассматривать протокол прорисовки чуть позже.
Но сначала бегло просмотрим \subind{Seaside}{multi-counter}.


% \subsection{From Counter to MultiCounter}
\subsection{От Counter до MultiCounter}

% \ct{WAMultiCounter}, shown in \figref{WAMultiCounter} is also a standalone application,
% so it overrides \mthind{WAComponent class}{canBeRoot} to answer \ct{true}.
% In addition, it is a \emph{composite} component, so Seaside requires it to declare its
% children by implementing a method \ct{children} that answers an array of all the
% components it contains.
% It renders itself by rendering each of its subcomponents, separated by a horizontal
% rule.Aside from instance and class-side initialization methods, there is nothing else to
% the multi-counter!

\ct{WAMutliCounter}, рассмотренный в \figref{WAMultiCounter} является к тому же
самостоятельным приложением, так как
переопределяет метод класса \mthind{WAComponent}{canBeRoot},
возвращающий результат \ct{true}.
В дополнение, WAMultiCounter - составной компонент.
Seaside требует регистрации вложенных компонентов
реализацией метода \ct{children},
который отвечает массивом вложенных компонентов.
Компонент сам прорисовывает каждый вложенный элемент,
разделяя горизонтальной линией.
Кроме экземпляра и инициализирующих методов со стороны класса,
в multiCounter больше ничего нет!

\begin{figure}[bht]
\begin{center}
\includegraphics[width=\textwidth]{WAMultiCounter}
\caption{WAMultiCounter}
\figlabel{WAMultiCounter}
\end{center}
\end{figure}

%-----------------------------------------------------------------
% \subsection{More about Rendering XHTML}
\subsection{Подробнее о создании XHTML}

% As you can see from these examples, Seaside does not use templates to generate web
% pages.Instead it generates XTHML programmatically.
% The basic idea is that every Seaside component should override the method
% \mthind{WAPresenter}{renderContentOn:}; this message will be sent by the framework to
% each component that needs to be rendered.
% This \ct{renderContentOn:} message will have argument that is an \seeindex{canvas}{html
% canvas} \emphind{html canvas} onto which the component should render itself. By
% convention, the html canvas parameter is called \ct{html}.
% An html canvas is analogous to the graphics canvas used by Morphic (and most other
% drawing frameworks) to abstract away from the device-dependent details of drawing.

Как Вы увидите из примеров, Seaside не использует шаблоны
для генерации веб-страниц.
Вместо них используется программная генерация XHTML.
Основная идея заключается в том,
что каждому компоненту нужно переопределить метод
\mthind{WAPresenter}{renderContentOn:};
и это сообщение будет посылаться компонентам,
когда их требуется отобразить на веб-странице.
Сообщение \ct{renderContentOn:} имеет один аргумент,
который является  \seeindex{canvas}{html canvas} html-страницей,
и где компоненты изображают себя.
По соглашению html-страница называется \ct{html}.
Html-страница является аналогом графического полотна
используемого в Morphic
(и для большинства других графических систем),
чтобы можно было абстрагироваться от устройство-зависимых
деталей рисования.

% Here are some of the most basic rendering methods:
Ниже расположено несколько базовых способов визуализации:
\begin{code}{}
html text: 'hello world'.  "render a plain text string"
html html: '&ndash;'.     "render an XHTML incantation"
html render: 1.              "render any object"
\end{code}

% The message \ct{render: anyObject} can be sent to an html canvas to render
% \ct{anyObject}; it is normally used to render subcomponents. \lct{anyObject} will itself
% be sent the message \ct{renderContentOn:}
% this is what happens in the multi-counter (see \figref{WAMultiCounter}).

Сообщение \ct{render: anyObject} может быть отправлено html-странице,
для отображения \ct{anyObject};
и это есть правильный способ изображения вложенных компонентов.
Объекту anyObject будет отправленно сообщение \ct{renderContentOn:}.
Такой способ будет использоваться в multi-counter
(смотрите \figref{WAMultiCounter}).

% \subsection{Using Brushes}
% \seclabel{brushes}

\subsection{Использование кистей}
\seclabel{brushes}

% A canvas provides a number of \emphind{brushes} that can be used to render (\ie
% ``paint'') content on the canvas.
% There are brushes for every kind of XHTML element\,---\,paragraphs, tables, lists, and soon.
% To see the full protocol of brushes and convenience methods, you should browse the class
% \clsind{WACanvas} and its subclasses.
% The argument to \ct{renderContentOn:} is actually an instance of the subclass
% \clsind{WARenderCanvas}.

веб-страница имеет определенное количество \emphind{кистей},
которые могут быть использованы при прорисовке его содержимого.
Имеются кисти для каждого элемента XHTML --- абзацы, таблицы, списки и т.д.
Чтобы ознакомиться с  протоколом кистей и необходимых методов,
Вам следует просмотреть класс \clsind{WACanvas} и его подклассы.
Аргумент метода \ct{renderContentOn:}
является экземпляром подкласса \clsind{WARenderCanvas}.

% We have already seen the following brush used in the counter and multi-counter examples:
% \needlines{2}
% \begin{code}{}
% html horizontalRule.
% \end{code}

Мы уже готовы просмотреть использование кисти в примерах counter и multi-counter:
\needlines{2}
\begin{code}{}
html horizontalRule.
\end{code}

\begin{figure}[ht]
\begin{center}
\includegraphics[width=\textwidth]{RenderingDemo}
\caption{Демонстрационный пример}
\figlabel{RenderingDemo}
\end{center}
\end{figure}

% In \figref{RenderingDemo} we can see the output of many of the basic brushes offered by
% Seaside.\footnote{The source code for \mthref{renderdemo} is in the package
% \ct{PBE-SeasideDemo} in the project \url{http://www.squeaksource.com/PharoByExample}.}
% The root component \ct{SeasideDemo} simply renders its subcomponents, which are instancesof \ct{SeasideHtmlDemo}, \ct{SeasideFormDemo}, \ct{SeasideEditCallDemo} and
% \ct{SeasideDialogDemo}, as shown in \mthref{renderdemo}.

На \figref{RenderingDemo} мы можем увидеть результат
рисования базовыми кистями Seaside.
\footnote{Программный код для \mthref{renderdemo} расположен в пакете
\ct{PBE-SeasideDemo} проекта \url{http://www.squeaksource.com/PharoByExample}.}
Корневой компонент \ct{SeasideDemo} просто изображает
вложенные компоненты,
которые являются экземплярами \ct{SeasideHtmlDemo}, \ct{SeasideFormDemo},
\ct{SeasideDialogDemo}, показанные в \mthref{renderdemo}.

\needspace{7ex}
\begin{method}[renderdemo]{\lct{SeasideDemo>>renderContentOn:}}
SeasideDemo>>>renderContentOn: html
	html heading: 'Rendering Demo'.
	html heading
		level: 2;
		with: 'Rendering basic HTML: '.
	html div
		class: 'subcomponent';
		with: htmlDemo.
	"render the remaining components ..."
\end{method}

\noindent
% Recall that a root component must always declare its children, or Seaside will refuse to
% render them.
Напомним,
что корневой компонент обязан всегда декларировать подкомпоненты,
в противном случае Seaside не сможет отображать их.


\begin{code}{}
SeasideDemo>>>children
	^ { htmlDemo . formDemo . editDemo . dialogDemo }
\end{code}

% Notice that there are two different ways of instantiating the \ct{heading} brush.
% The first way is to set the text directly by sending the message \ct{heading:}.
% The second way is instantiate the brush by sending \ct{heading}, and then to send a
% cascade of messages to the brush to set its properties and render it.
% Many of the available brushes can be used in these two ways.

Обращаем внимание,
что существуют два различных способа создания кисти заголовка.
Первый способ использует посылку сообщения \ct{heading:}.
Второй, созданием экземпляра кисти, путем посылки сообщения \ct{heading},
и далее посылки каскадных сообщений, для установки свойств заголовка.
Большинство из доступных кистей могут использовать эти способы.

%\important{If you send a \ind{cascade} of messages to a brush including the message
% \mthind{WABrush}{with:}, then \ct{with:} should be the \emph{final} message.
% \ct{with:}  both sets the content and renders the result.}

\important{Если Вы отправляете каскадные сообщения для кисти,
то последним должно быть сообщение \mthind{WABrush}{with:},
которое и отображает на основе измененных свойств.}


% In \mthref{renderdemo}, the first heading is at level 1, since this is the default.
% We explicitly set the level of the second heading to 2.
% The subcomponent is rendered as an XHTML \emph{div} with the \ind{CSS} class
% ``subcomponent''.
% (More on CSS in \secref{css}.)
% Also note that the argument to the \ct{with:} keyword message need not be a literal
% string: it can be another component, or even\,---\,as in the next example\,---\,a block
% containing further rendering actions.

У метода \mthref{renderdemo}, первый заголовок имеет уровень 1,
установленный по умолчанию.
Явно установлен 2 уровень у второго заголовка.
Вложенные компоненты прорисовываются как XHTML \emph{div} контейнер
с использованием таблицы каскадных стилей (\ind{CSS}).
(Более подробно о CSS в \secref{css}.)
Обращаем внимание, что аргумент ключевого сообщения \ct{with:}
не должен быть литерной строкой, а может быть другим компонентом,
или даже\,---\,(как в следующем примере) блоком с инструкциями
прорисовки веб-страницы.

% The \ct{SeasideHtmlDemo} component demonstrates many of the most basic brushes.
% Most of the code should be self-explanatory.

Компонент \ct{SeasideHtmlDemo} демонстрирует много базовых кистей.
И построен по принципу самокомментируемости.

\begin{code}{}
SeasideHtmlDemo>>>renderContentOn: html 
	self renderParagraphsOn: html.
	self renderListsAndTablesOn: html.
	self renderDivsAndSpansOn: html.
	self renderLinkWithCallbackOn: html
\end{code}

% It is common practice to break up long rendering methods into many helper methods,
% as we
% have done here.

Это обычная практика,
когда метод прорисовки компонента разбивается на несколько вспомогательных.

% \important{Don't put all your rendering code into a single method. 
% Split it into helper methods named using the pattern \ct{render*On:}.
% All rendering methods go in the \prot{rendering} protocol.
% Don't send \ct{renderContentOn:} from your own code, use \ct{render:} instead.}

\important{Не надо располагать программный код в одном методе.
Лучше разделить его на несколько вспомогательных
и назвать каждый метод по принципу \ct{render*On:}.
Все методы рисования входят в протокол \prot{rendering}.
Не используйте сообщение \ct{renderContentOn:} в вашем программном коде,
правильнее будет \ct{render:}}

% Look at the following code.  
% The first helper method, \ct{SeasideHtmlDemo>>>renderParagraphsOn:}, shows you how to
% generate XHTML paragraphs, plain and emphasized text, and images.
% Note that in Seaside simple elements are rendered by specifying the text they contain
% directly, whereas complex elements are specified using blocks.
% This is a simple convention to help you structure your rendering code.

Посмотрите на нижерасположенный код.
Первый вспомогательный метод, \ct{SeasideHtmlDemo>>>renderParagraphsOn:},
показывает нам как генерировать XHTML абзацы,
обычный и подчеркнутый текст и изображения.
Обращаем внимание, что в Seaside, простые элементы прорисовывают себя,
указывая содержимое непосредственно,
а комплексные элементы используют блоки.
Придерживаясь этих простых правил,
вы упростите структуру программного кода прорисовки.

\begin{code}{}
SeasideHtmlDemo>>>renderParagraphsOn: html 
	html paragraph: 'A plain text paragraph.'.
	html paragraph: [
		html
			text: 'A paragraph with plain text followed by a line break. ';
			break;
			emphasis: 'Emphasized text ';
			text: 'followed by a horizontal rule.';
			horizontalRule;
			text: 'An image URI: '.
		html image
			url: self squeakImageUrl;
			width: '50']
\end{code}

% The next helper method, \ct{SeasideHtmlDemo>>>renderListsAndTablesOn:}, shows you how to
% generate lists and tables.
% A table uses two levels of blocks to display each of its rows and the cells within the
% rows.

Следующий вспомогательный метод,
\ct{SeasideHtmlDemo>>>renderListsAndTablesOn:},
показывает нам, как генерировать списки и таблицы.
Таблицы используют двухуровневые блоки,
чтобы показывать каждую строку с ячейками.

\begin{code}{}
SeasideHtmlDemo>>>renderListsAndTablesOn: html 
	html orderedList: [
		html listItem: 'An ordered list item'].
	html unorderedList: [
		html listItem: 'An unordered list item'].
	html table: [
		html tableRow: [
			html tableData: 'A table with one data cell.']]
\end{code}

% The next example shows how we can specify CSS \emph{div}s and \emph{span}s with
% \emph{class} or \emph{id} attributes.
% Of course, the messages \ct{class:} and \ct{id:} can also be sent to the other brushes,
% not just to \emph{div}s and \emph{span}s.
% The method \ct{SeasideDemoWidget>>>style} defines how these XHTML elements should be
% displayed (see \secref{css}).

Следующий пример объясняет как использовать CSS в \emph{div} и
\emph{span} контейнерах с атрибутами \emph{class} и \emph{id}.
Конечно, сообщения \ct{class:} и \ct{id:} можно отправлять любой кисти,
и все-таки лучше и правильнее использовать
для \emph{div} и \emph{span} контейнеров.
Метод \ct{SeasideDemoWidget>>>style} определяет как эти XHTML-элементы
будут изображены.

\begin{code}{}
SeasideHtmlDemo>>>renderDivsAndSpansOn: html 
	html div
		id: 'author';
		with: [
			html text: 'Raw text within a div with id ''author''. '.
			html span
				class: 'highlight';
				with: 'A span with class ''highlight''.']
\end{code}

% Finally we see a simple example of a link, created by binding a simple
% \subind{Seaside}{callback} to an ``anchor'' (\ie a link).
% Clicking on the link will cause the subsequent text to toggle between ``true'' and
% ``false'' by toggling the instance variable \ct{toggleValue}.

И в заключении мы покажем простой пример со ссылками,
созданные при помощи \subind{Seaside}{callback} (блок обратного вызова).
Активизация ссылки будет переключать значение переменной toggleValue
из <<true>> на <<false>> и обратно, которое отображается после ссылки.

\needlines{3}
\begin{code}{}
SeasideHtmlDemo>>>renderLinkWithCallbackOn: html 
	html paragraph: [
		html text: 'An anchor with a local action: '.
		html span with: [
			html anchor
				callback: [toggleValue := toggleValue not];
				with: 'toggle boolean:'].
		html space.
		html span
			class: 'boolean';
			with: toggleValue ]
\end{code}

% \important{Note that actions should appear only in callbacks.
% The code executed while rendering should not change the state of the application!}

\important{Обратите внимание,
что все действия со стороны веб-страницы, 
нужно распологать в блоках обратного вызова.
Код выполняемый при прорисовке html-страницы не должен
изменять состояние приложения.
}

%-----------------------------------------------------------------
% \subsection{Forms}
\subsection{Формы}

% Forms are rendered just like the other examples that we have already seen.
% Here is the code for the \ct{SeasideFormDemo} component in \figref{RenderingDemo}.
% \index{Seaside!XHTML forms}

формы отображаются точно также как и другие примеры,
которые мы уже привели.
Далее приведен код компонента \ct{SeasideFormDemo} представленный на
\figref{RenderingDemo}.
\index{SeasideXHTML forms}

\begin{code}{}
SeasideFormDemo>>>renderContentOn: html
	| radioGroup |
	html heading: heading.
	html form: [
		html span: 'Heading: '.
		html textInput on: #heading of: self.
		html select
			list: self colors;
			on: #color of: self.
		radioGroup := html radioGroup.
		html text: 'Radio on:'.
		radioGroup radioButton
			selected: radioOn;
			callback: [radioOn := true].
		html text: 'off:'.
		radioGroup radioButton
			selected: radioOn not;
			callback: [radioOn := false].
		html checkbox on: #checked of: self.
		html submitButton
			text: 'done' ]
\end{code}{}

% Since a form is a complex entity, it is rendered using a block.
% Note that all the state changes happen in the callbacks, not as part of the rendering.

Поскольку форма является сложным компонентом, отображается она с использованием блока.

% There is one Seaside feature used here that is worth special mention, namely the message
% \mthind{WAAnchorTag}{on:of:}.
% In the example, this message is used to bind a text input field to the variable
% \ct{heading}.
% Anchors and buttons also support this message.
% The first argument is the name of an instance variable for which accessors have been
% defined; the second argument is the object to which this instance variable belongs.
% Both observer (\ct{heading}) and mutator (\ct{heading:}) accessor messages must be
% understood by the object, with the usual naming convention.
% In the case here of a text input field, this saves us the trouble of having to define a
% callback that updates the field as well as having to bind the default contents of the
% html input field to the current value of the instance variable.
% Using \ct{on: #heading of: self}, the \ct{heading} variable is updated automatically
% whenever the user updates the text input field.

Существует одно свойство Seaside которое заслуживает особого внимания,
а именно сообщение \mthind{WAAnchorTag}{on:of:}.
В примере,
это сообщение используется для связывания текстового
поля с переменной \ct{heading}.
Гиперссылки и кнопки тоже поддерживают это сообщение.
Первый аргумент\,---\,имя экземпляра переменной для которой нужен доступ;
вторым аргументом является объект
к которому экземпляр переменной принадлежит.
Сообщения доступа \ct{heading} и \ct{heading:}
должны быть реализованы в объекте.
В данном случае для текстового поля ---
это избавит нас от проблемы определения блока обратного вызова,
который бы обновлял содержимое поля, а также для того
чтобы связать c текущим значением экземпляра переменной.
Используя \ct{on: #heading of: self},
переменная \ct{heading} автоматически обновляется, когда пользователь изменяет содержимое поля.


% The same message is used twice more in this example, to cause the selection of a colour
% on the html form to update the \ct{color} variable, and to bind the result of the
% checkbox to the \ct{checked} variable.
% Many other examples can be found in the functional tests for Seaside.
% Have a look at the category \scat{Seaside-Tests-Functional}, or just point your browser
% to \url{http://localhost:8080/seaside/tests/alltests}.
% Select \menu{WAInputTest} and click on the \button{Restart} button to see most of the
% features of forms.

То же самое сообщение используется более двух раз в этом примере,
связанной с выбором цвета на html-форме,
при обновлении переменной \ct{color}, и связанное значение переменной
\ct{checked} c элементом формы checkbox.
Также можно найти много других похожих примеров в Seaside тестах.
Посмотрите в категории \scat{Seaside-Tests-Functional},
или в браузере откройте страницу
\url{http://localhost:8080/seaside/tests/alltests}.
Далее выберите \menu{WAInputTests} и нажмите на кнопку \button{Restart},
чтобы просмотреть большинство возможностей формы.

% Don't forget, if you \button{Toggle Halos}, you can browse the source code of the
% examples directly using the Seaside class browser.

Не забывайте, если вы активизируете \button{Toggle Halos},
то можете просматривать программный код примеров,
используя браузер классов Seaside.

%-----------------------------------------------------------------
% \section{CSS: Cascading style sheets}
% \seclabel{css}

\section{CSS: Таблицы каскадных стилей}
\seclabel{css}

%\ab{I think that it just needs a few paragraphs telling the reader the key ideas behind


% CSS, and the new terminology that the CSS folks introduce, before going in to the detailsof how you define their "thingies". Now I have forgotten what they call their "thingies"
% --- I know that there are effectively paragraph styles (divs) and character styles
% (spans), but I've forgotten what they call them. So, I think that the text needs to tell
% the reader, for each thingie, (1) the CSS concept behind the thingie, (2) what it looks
% like in a CSS style sheet , (3) what it looks like in html, and (4) how to do it in
% Seaside. Maybe (3) can be omitted, because it's not needed to use Seaside.



% \on{I think we do most of that already.}

% Cascading Style Sheets\footnote{\url{http://www.w3.org/Style/CSS/}}, or \ind{CSS} for
% short, have emerged as a standard way for web applications to separate style from
% content.
% Seaside relies on CSS to avoid cluttering your rendering code with layout considerations.You can set the CSS style sheet for your web components by defining the method
% \ct{style}, which should return a string containing the CSS rules for that component.
% The styles of all the components displayed on a web page are joined together, so each
% component can have its own style.
% A better approach can be to define an abstract class for your web application that
% defines a common style for all its subclasses.

Каскадные таблицы стилей \footnote{\url{http://www.w3.org/Style/CSS/}},
или \ind{CSS} для краткости,
появились чтобы стандартизировать веб-приложения,
в которых стиль отделен от содержания.
Seaside базируется на CSS,
чтобы избежать захламление программного кода страницы.
Вы можете определить CSS-стиль для вашего веб-компонента изменив метод
\ct{style}, который должен вернуть строку вмещающую CSS правила
для компонента.
Стили всех компонентов показываются на веб-странице вместе,
и каждый компонент может иметь свой собственный стиль.
Наиболее лучший способ состоит в определении абстрактного класса
для выших веб-приложений,
который определяет общий стиль для всех его подклассов.

% Actually, for deployed applications, it is more common to define style sheets as externalfiles.
% This way the look and feel of the component is completely separate from its
% functionality.
% (Have a look at \clsind{WAFileLibrary}, which provides a way to serve static files
% without the need for a standalone server.)

Также для работающих приложений применяется другой подход,
который основан на внешних файлах.
Таким образом внешний вид компонента полностью отделен
от его функциональности.
(Обратите внимание на \clsind{WAFileLibrary}, которая обеспечивает
хранение статических небольших файлов,
без необходимости использования самостоятельного сервера.)

% If you already are familiar with CSS, then that's all you need to know.
% Otherwise, read on for a very brief introduction to CSS.

Знакй,
дальнейшее чтение этой главы будет полезно в лубом случае.
омы вы или нет с каскадными таблицами стилей
% Instead of directly encoding display attributes in the paragraph and text elements of
% your web pages, with CSS you will define different classes of elements and place all
% display considerations in a separate style sheet.
% Paragraph-like entities are called \emph{div}s and text-like entities are \emph{span}s.
% You would then define symbolic names, like ``highlight'' (see example below) for text to
% be highlighted, and specify how highlighted text is to be displayed in your style sheet.

Вместо прямого кодирования атрибутов в параграфе и у текстовых элементов
на вашей веб-странице,
использую CSS можно определить различные классы элементов
и разместить в соответствующих таблицах стилей.
Похожие на абзац контейнеры называются \emph{div}
и текстоподобные элеменыты \emph{span}.
Эти элементы можно определить с символическими именами,
например, <<highlight>> (смотрите пример ниже) для подсвеченного текста,
и специфицировать соответствующую CSS.

% Basically a CSS style sheet consists of a set of rules that specify how to format given
% XHTML elements.
% Each rule consists of two parts.
% There is a \emph{selector} that specifies which XHTML elements the rule applies to, and
% there is a \emph{declaration} which sets a number of attributes for that element.

В своей основе CSS таблицы состоят из набора правил,
которые специфицируют как форматировать XHTML-элементы.
Каждое правило состоит из двух частей.
Первая часть \emph{selector}, определяет для каких XHTML-элементов
предназначено правило,
и вторая часть \emph{declaration}, содержит набор атрибутов для элемента.

\begin{figure}[tb]
\begin{code}{}
SeasideDemoWidget>>>style
	^ '
body {
	font: 10pt Arial, Helvetica, sans-serif, Times New Roman;
}
h2 {
	font-size: 12pt;
	font-weight: normal;
	font-style: italic;
}
table { border-collapse: collapse; }
td {
	border: 2px solid #CCCCCC;
	padding: 4px;
}
#author {
	border: 1px solid black;
	padding: 2px;
	margin: 2px;
}
.subcomponent {
	border: 2px solid lightblue;
	padding: 2px;
	margin: 2px;
}
.highlight { background-color: yellow; }
.boolean { background-color: lightgrey; }
.field { background-color: lightgrey; }
'
\end{code}
\caption{Общая таблица стилей \lct{SeasideDemoWidget}.
\figlabel{democss}}
\end{figure}

% \figref{democss} illustrates a simple style sheet for the rendering demo shown earlier in\figref{RenderingDemo}.
% The first rule specifies a preference for the fonts to use for the \ct{body} of the web
% page.
% The next few rules specify properties of second-level headings (\ct{h2}), tables
% (\ct{table}), and table data (\ct{td}).

\figref{democss} иллюстрирует простую таблицу стилей,
используемую для приведенного ранее примера на \figref{RenderingDemo}.
Первое правило определяет атрибуты шрифтов,
используемые разделом \ct{body} веб-страницы.
Следующие несколько правил устанавливают параметры
для заголовков второго уровня (\ct{h2}), таблиц (\ct{table}) и
табличных данных (\ct{td}). 

% The remaining rules have selectors that will match XHTML elements that have the given
% ``class'' or ``id'' attributes.
% CSS selectors for class attributes start with a ``\ct{.}'' and those for id attributes
% with ``\ct{#}''.
% The main difference between class and id attributes is that many elements may have the
% same class, but only one element may have a given id (\ie an \emph{identifier}).
% So, whereas a class attribute, such as \ct{highlight}, may occur multiple times on any
% page, an id must identify a \emph{unique} element on the page, such as a particular menu,the modified date, or author.
% Note that a particular XHTML element may have multiple classes, in which case all the
% applicable display attributes will be applied in sequence.

Остальные правила селекторов имеют соответствие XHTML-элементам по
атрибутам <<class>> и <<id>>.
CSS-селекторы для классовых атрибутов начинаются с <<\ct{.}>>,
а для id-атрибутов <<\ct{#}>>.
Основное отличие между классовыми и id-атрибутами в том,
что много элементов могут имет одинаковый класс,
но только один элемент имеет id-селектор (или идентификатор).
Таким образом, классовый стиль, такой как \ct{highlight},
может несколько раз повторятся на веб-странице.
id идентифицирует уникальный элемент, к примеру,
основное меню, дата или раздел об авторе.
Заметим, что определенный XHTML-элемент может иметь несколько классов,
в таком случае все атрибуты будут применяться последовательно.

% This style sheet expects at most one element to specify the \emph{author} of the web page.

% Selector conditions may be combined, so the selector \ct{div.subcomponent} will only
% match an XHTML element if it is both a div \emph{and} it has a class attribute equal to
% ``subcomponent''.

Селектор может быть комбинированным, так \ct{div.subcomponent}
будет соответствовать XHTML элементу если div-контейнер является
классом <<subcomponent>>. 

% It is also possible to specify nested elements, though this is seldom necessary.
% For example, the selector ``\ct{p span}'' will match a span within a paragraph but not
% within a div.

Кроме того можно указать вложенные элементы,
хотя необходимость возникает редко.
Например, селектор <<\ct{p span}>> будет соответствовать элементу span
в пределах абзаца, но не контейнера div.

% There are numerous books and web sites to help you learn CSS.
% For a dramatic demonstration of the power of CSS, we recommend you to have a look at the
% CSS Zen Garden\footnote{\url{http://www.csszengarden.com/}}, which shows how the same
% content can be rendered in radically different ways simply by changing the CSS style
% sheet.

Имеется большое количество книг и веб-сайтов способных помочь вам
при изучении CSS.
Для демонстрации возможностей CSS,
мы рекомендуем вам посетить сайт \footnote{\url{http://www.csszengarden.com/}},
в котором одинаковое содержимое представленно с различными вариантами CSS.

%-----------------------------------------------------------------
% \section{Managing control flow}
\section{Управление потоками}

% Seaside makes it particularly easy to design web applications with non-trivial control
% flow.
% There are basically two mechanisms that you can use:

Seaside позволяет простыми способами спроектировать веб-приложение с
нетривиальным  управлением потока.

% \begin{enumerate}
% \item A component can \emph{call} another component by sending \ct{caller call: callee}.
% The caller is temporarily replaced by the callee, until the callee returns
% control by
% sending \ct{answer:}.
% The caller is usually \ct{self}, but could also be any other currently visible component.  \item A workflow can be be defined as a \emphsubind{Seaside}{task}.
% This is a special kind of component that subclasses \clsind{WATask} (instead of
% \clsind{WAComponent}). \seclabel{task}
% Instead of defining \ct{renderContentOn:}, it defines no content of its own, but rather
% defines a \ct{go} method that sends a series of \ct{call:} messages to activate various
% subcomponents in turn.
% \end{enumerate}
% \index{Seaside!control flow}

\begin{enumerate}
\item Компонент может вызвать другой компонент путем посылки сообщения
\ct{caller call: callee}.
Вызывающий компонент временно заменяется вызываемым,
до тех пор пока вызываемый компонент не вернет управление посылкой
сообщения \ct{answer:}.
Вызывающий компонент может быть любым видимым компонентом.

\item Рабочий процесс может быть определен как задача,
являющимся специальным свойством компонентов подкласса \clsind{WATask}
(вместо WAComponent).
Вместо определения метода \ct{renderContentOn:}, переопределяется метод
\ct{go}, который посылает серии сообщений \ct{call:},
чтобы активизировать различные вложенные компоненты.

\end{enumerate}
\index{Seaside!управление потоками}

%-----------------------------------------------------------------
% \subsection{Call and answer}

\subsection{Вызов и ответ компонентов}

% Call and answer are used to realize simple dialogues.

Вызовы и ответы используются чтобы реализовать простые диалоги.

% There is a trivial example of \ct{call:} and \ct{answer:} in the rendering demo of
% \figref{RenderingDemo}.
% The component \ct{SeasideEditCallDemo} displays a text field and an \emph{edit} link.
% The callback for the edit link calls a new instance of \ct{SeasideEditAnswerDemo}
% initialized to the value of the text field.
% The callback also updates this text field to the result which is sent as an answer.

В книге был представлен тривиальный пример демонстрации на
\figref{RenderingDemo}, в которой используются методы \ct{call:} и \ct{answer:}.
В компоненте \ct{SeasideEditDemo} показывается текстовое поле и ссылка
\emph{edit}.
Блок обратного вызова ссылки edit создает и вызывает экземпляр
\ct{SeasideEditAnswerDemo} с инициализированным значением текстового поля.
В обратном вызове обновляется текстовое поле на основе ответа.

% (We underline the \ct{call:} and \ct{answer:} sends to draw attention to them.)

(Мы подчеркнули методы \ct{call:} и \ct{answer:}, чтобы вы обратили
на них внимание)

\begin{code}{}
SeasideEditCallDemo>>>renderContentOn: html 
	html span
		class: 'field';
		with: self text.
	html space.
	html anchor
callback: [self text: (self !\underline{call:}! (SeasideEditAnswerDemo new text: self
text))];
		with: 'edit'
\end{code}{}

% What is particularly elegant is that the code makes absolutely no reference to the new
% web page that must be created.
% At run-time, a new page is created in which the \ct{SeasideEditCallDemo} component is
% replaced by a \ct{SeasideEditAnswerDemo} component; the parent component and the other
% peer components are untouched.

Выглядит особенно элегантно, так как код не имеет никаких ссылок на
новую веб-страницу, которую нужно еще создать.
Во время исполнения создается новая страница, которая заменяет
компонент \ct{SeasideEditCallDemo} на \ct{SesideEditAnswerDemo}.
Родительский и другие компоненты остаются нетронутыми.

% \important{\mthind{WAComponent}{call:} and \mthind{WAComponent}{answer:} should never be
% used while rendering.
% They may safely be sent from within a \subind{Seaside}{callback}, or from within the
%$ \mthind{WATask}{go} method of a task.}

\important{
Методы \mthind{WAComponent}{call:} и
\mthind{WAComponent}{answer:} не следует никогда использовать
во время прорисовывания.
Их только можно безопастно отправлять из блоков обратного вызова и
методов экземпляра WATask.
}

% The \ct{SeasideEditAnswerDemo} component is also remarkably simple.
% It just renders a form with a text field.
% The submit button is bound to a callback that will answer the final value of the text
% field.

Компонент \ct{SeasideEditAnswerDemo} совсем простой.
Он только отображает форму с текстовым полем.
К кнопке прикреплен обратный вызов, который отвечает окончательным
значением текстового поля.

\begin{code}{}
SeasideEditAnswerDemo>>>renderContentOn: html
	html form: [
		html textInput
			on: #text of: self.
		html submitButton
			callback: [ self !\underline{answer:}! self text ];
			text: 'ok'.
		]
\end{code}{}

% That's it.

Вот и все.

% Seaside takes care of the control flow and the correct rendering of all the components.
% Interestingly, the ``back'' button of the browser will also work just fine (though side
% effects are not rolled back unless we take additional steps).

Seaside аккуратно управляет потоками и корректно отображает все
компоненты. Кнопка <<back>> браузера тоже работает правильно.

%-----------------------------------------------------------------
% \subsection{Convenience methods}

\subsection{Полезные методы}

% Since certain call--answer dialogues are very common, Seaside provides some convenience
% methods to save you the trouble of writing components like \ct{SeasideEditAnswerDemo}.
% The generated dialogues are shown in \figref{dialogs}.
% We can see these convenience methods being used within
% \ct{SeasideDialogDemo>>>renderContentOn:}
% \index{Seaside!convenience methods}

Диалоги call--answer примерно одинаковые и в Seaside имеется несколько
полезных методов, позволяющих вам сэкономить время.
Диалоги показаны на \figref{dialogs}.
Мы можем также увидеть эти методы в
\ct{SeasideDialogDemo>>renderContentOn:}
\index{Seaside!convenience methods}

\begin{figure}[b]
\begin{center}
\includegraphics[width=\textwidth]{dialogs}
\caption{Несколько стандартных диалогов}
\figlabel{dialogs}
\end{center}
\end{figure}

% The message \mthind{WAComponent}{request:} performs a call to a component that will let
% you edit a text field.
% The component answers the edited string.
% An optional label and default value may also be specified.

Сообщение \mthind{WAComponent}{request:} формирует вызов
компонента, который изменяет текстовое поле.
Компонент отвечает отредактированной строкой.
Дополнительные надписи и значения по умолчанию,
могут быть также определены.

\needlines{3}
\begin{code}{}
SeasideDialogDemo>>>renderContentOn: html
	html anchor
		callback: [ self request: 'edit this' label: 'done' default: 'some text' ];
		with: 'self request:'.
...
\end{code}

% The message \mthind{WAComponent}{inform:} calls a component that simply displays the
% argument message and waits for the user to click ``ok''.
% The called component just returns \ct{self}.

Сообщение \mthind{WAComponent}{inform:} вызывает компонент,
который просто показывает аргумент сообщения и ждет когда пользователь
нажмет <<ok>>.
Вызванный компонент возвращает себя.

\begin{code}{}
...
	html space.
	html anchor
		callback: [ self inform: 'yesBANG' ];
		with: 'self inform:'.
...
\end{code}

% The message \mthind{WAComponent}{confirm:} asks a questions and waits for the user to
% select either ``Yes'' or ``No''.
% The component answers a boolean, which can be used to perform further actions.

Сообщение \mthind{WAComponent}{confirm:} спрашивает и ждет когда
пользователь выберет <<Yes>> или <<No>>.
А в качестве ответа возвращается логическое значение.

\begin{code}{}
...
	html space.
	html anchor
		callback: [
			(self confirm: 'Are you happy?')
				ifTrue: [ self inform: ':-)' ]
				ifFalse: [ self inform: ':-(' ]
			];
		with: 'self confirm:'.
\end{code}

% A few further convenience methods, such as \mthind{WAComponent} {chooseFrom:caption:}, aredefined in the \prot{convenience} protocol of \clsind{WAComponent}.

Еще несколько полезных методов, таких как, например,
\mthind{WAComponent}{chooseFrom:caption:},
определены в протоколе \prot{convenience}
класса \clsind{WAComponent}.

%-----------------------------------------------------------------
% \subsection{Tasks}

\subsection{Задачи}

% A \subind{Seaside}{task} is a component that subclasses \clsind{WATask}.
% It does not render anything itself, but simply calls other components in a control flow
% defined by implementing the method \mthind{WATask}{go}.

\subind{Seaside}{Task} является компонентом подкласса \clsind{WATask}.
Основное назначение - вызывать другие компоненты и управлять потоками
через метод \mthind{WATask}{go}.

% \clsind{WAConvenienceTest} is a simple example of a task defined in the category
% \scat{Seaside-Tests-Functional}.
% To see its effect, just point your browser to
% \url{http://localhost:8080/seaside/tests/alltests}, select \menu{WAConvenienceTest} and
% click \button{Restart}.

В категории \scat{Seaside-Tests-Functional} имеется простой пример задачи
\clsind{WAConvenienceTest}.
Чтобы просмотреть,
выберите в браузере \url{http://localhost:8080/seaside/tests/alltests},
далее \menu{WAConvenienceTest} и нажмите кнопку \button{Restart}.

\begin{code}{}
WAConvenienceTest>>>go
	[ self chooseCheese.
	  self confirmCheese ] whileFalse.
	self informCheese
\end{code}

% This task calls in turn three components.
% The first, generated by the convenience method \mthind{WAComponent}{chooseFrom:
% caption:}, is a \clsind{WAChoiceDialog} that asks the user to choose a cheese.

Эта задача вызывает три компонента.
Первый генерирует метод \mthind{WAComponent}{chooseFrom:caption:},
являющийся экземпляром класса \clsind{WAChoiceDialog},
который просит пользователя выбрать сыр.

\begin{code}{}
WAConvenienceTest>>>chooseCheese
	cheese := self
		chooseFrom: #('Greyerzer' 'Tilsiter' 'Sbrinz')
		caption: 'What''s your favorite Cheese?'.
	cheese isNil ifTrue: [ self chooseCheese ]
\end{code}

% \alex{Is there a situation where cheese may be nil? Maybe if a browser authorizes an
% empty selection...

% The second is a \clsind{WAYesOrNoDialog} to confirm the choice (generated by the
% convenience method \mthind{WAComponent}{confirm:}).

Второй - экземпляр \clsind{WAYesOrNoDialog} подтверждает или нет выбор
(генерируется методом \mthind{WAComponent}{confirm:}). 

\begin{code}{}
WAConvenienceTest>>>confirmCheese
	^self confirm: 'Is ', cheese,  ' your favorite cheese?'
\end{code}

% Finally a \clsind{WAFormDialog} is called (via the convenience method
% \mthind{WAComponent}{inform:}).

И последний третий - вызывает метод \mthind{WAComponent}{inform:}
компонента \clsind{WAFormDialog}.

\begin{code}{}
WAConvenienceTest>>>informCheese
	self inform: 'Your favorite cheese is ', cheese, '.'
\end{code}

% The generated dialogues are shown in \figref{chooseCheese}.

Генерированные диалоги показаны на \figref{chooseCheese}.

\begin{figure}[ht]
\begin{center}
\includegraphics[width=\textwidth]{chooseCheese}
\caption{Простая задача}
\figlabel{chooseCheese}
\end{center}
\end{figure}

%-----------------------------------------------------------------
% \subsection{Transactions}

\subsection{Транзакции}

% We saw in \secref{backtracking} that Seaside can keep track of the correspondence betweenthe state of components and individual web pages by having components register their
% state for backtracking:
% all that a component need do is implement the method \ct{states} to answer an array of
% all the objects whose state must be tracked.

Мы видели в \secref{backtracking},
что Seaside может сохранять предыдущие состояния компонентов для
индивидуальных веб-страниц.
У всех компонентов только требуется реализовать метод \ct{states},
отвечающий коллекцией вложенных компонентов, нужных для сохранения
состояния страницы.

% Sometimes, however, we do not want to backtrack state: instead we want to \emph{prevent}
% the user from accidentally undoing effects that should be permanent.
% This is often referred to as ``the shopping cart problem''.
% Once you have checked-out your shopping cart and paid for the items you have purchased,
% it should not be possible to go ``back'' with the browser and add more items to the
% shopping cart!

Иногда, однако, необходимо не сохранять предыдущую страницу.
К примеру, чтобы пользователь случайно не отменил свойство,
которое должно быть постоянным.
Это часто упоминается как <<проблема корзины покупателя>>
в электронном магазине.

% Seaside allows you to prevent this by defining a task within which certain actions are
% grouped together as \emph{transactions}.
% You can backtrack within a transaction, but once a transaction is complete, you can no
% longer go back to it.
% The corresponding pages are \emph{invalidated}, and any attempt to go back to them will
% cause Seaside to generate a warning and redirect the user to the most recent valid page.

Seaside позволяет в таких случаях защитить пользователя,
путем реализации транзакции на основе класса WATask.
Пока транзакция не закончена вы не сможете вернуться
на прежнее состояние.
Страницы становятся недействительные, и попытки
вернуться приводят к выводу предупреждения и возвращения
на действительную страницу.

\begin{figure}[ht]
\begin{center}
\includegraphics[width=\textwidth]{sushiStore}
\caption{Магазин суши}
\figlabel{sushiStore}
\end{center}
\end{figure}

% The Seaside \emphsubind{Seaside}{Sushi Store} is sample application that illustrates manyof the features of Seaside, including transactions.
% This application is bundled with your installation of Seaside, so you can try it out by
% pointing your browser at
% \url{http://localhost:8080/seaside/examples/store}.\footnote{If you cannot find it in
% your image, there is a version of the sushi store available on SqueakSource from
% \url{http://www.squeaksource.com/SeasideExamples/}.}

Приложение \emphsubind{Seaside}{Sushi Store} иллюстрирует многие из свойств
фреймворка, включая транзакции.
Это приложение устанавливается вместе с Seaside, и вы можете попробовать
его, набрав в адресной строке браузера
\url{http://localhost:8080/seaside/examples/store}.
\footnote{если вы не сможете найти его в вашем образе, в таком случае
версия Sushi Store доступна на SqueakSource по адресу
\url{http://www.squeaksource.com/SeasideExamples/}.}

% The sushi store supports the following workflow:
% \begin{enumerate}[itemsep=0pt]
%   \item Visit the store.
%   \item Browse or search for sushi.
%   \item Add sushi to your shopping cart.
%   \item Checkout.
%   \item Verify your order.
%   \item Enter shipping address.
%  \item Verify shipping address.
%  \item Enter payment information.
%  \item Your fish is on its way!
% \end{enumerate}

В Sushi Store реализован следующий рабочий процесс:
\begin{enumerate}[itemsep=0pt]
 \item Посещение магазина.
 \item Обзор и поиск.
 \item Добавление суши в корзину покупателя.
 \item Оформление заказа.
 \item Проверка заказа.
 \item Ввод адреса доставки.
 \item Проверка адреса доставки.
 \item Ваша рыба отправлена к месту доставки.
\end{enumerate}

% If you toggle the \subind{Seaside}{halos}, you will see that the top-level component of
% the sushi store is an instance of \clsind{WAStore}.
% It does nothing but render the title bar, and then it renders \ct{task}, an instance of
% \clsind{WAStoreTask}.

Если вы включите \subind{Seaside}{halos}, то увидите на верхнем уровне
компонент Sushi store, экземпляр \clsind{WAStore}.
В нем выводится только название а далее отображается подкомпонент
\ct{task}, экземпляр \clsind{WAStoreTask}.

\begin{code}{}
WAStore>>>renderContentOn: html
	"... render the title bar ..."
	html div id: 'body'; with: task
\end{code}

% \clsind{WAStoreTask} captures this workflow sequence. At a couple of points it is
% critical that the user not be able to go back and change the submitted information.

\clsind{WAStoreTask} полностью контролирует рабочий процесс.
И самое главное, пользователь не может вернуться назад и изменить
введенную ранее информацию.

\dothis{\,<<Purchase>> some sushi and then use the <<back>> button to try to put more
sushi into your cart.
You will get the message ``That page has expired.''}

% Seaside lets the programmer say that a certain part of a workflow act like a transaction:once the transaction is complete, the user cannot go back and undo it.
% You say this by sending \mthind{WAComponent}{isolate:} to a task with the transactional
% block as its argument.
% We can see this in the sushi store workflow as follows:

Seaside позволяет программисту предупредить,
что часть рабочего процесса является транзакцией,
которая пока не завершена должна быть выполнена.
Посылка сообщения \mthind{WAComponent}{isolate:},
с блоком в качестве аргумента, надежно защищает транзакцию.
Вы можете увидеть это в рабочих этапах Sushi Store:

\begin{code}{}
WAStoreTask>>>go
	| shipping billing creditCard |
	cart := WAStoreCart new.
	self isolate:
		[[self fillCart.
		self confirmContentsOfCart]
			whileFalse].

	self isolate:
		[shipping := self getShippingAddress.
		billing := (self useAsBillingAddress: shipping)
					ifFalse: [self getBillingAddress]
					ifTrue: [shipping].
		creditCard := self getPaymentInfo.
		self shipTo: shipping billTo: billing payWith: creditCard].

	self displayConfirmation.
\end{code}

% Here we see quite clearly that there are two transactions.
% The first fills the cart and closes the shopping phase.
% (The helper methods \ct{fillCart} \etc take care of instantiating and calling the right
% subcomponents.)
% Once you have confirmed the contents of the cart you cannot go back without starting a
% new session.
% The second transaction completes the shipping and payment data.
% You can navigate back and forth within the second transaction until you confirm payment.
% However, once both transactions are complete, any attempt to navigate back will fail.

В программном коде видим, что используются две транзакции.
Первая заполняет карту и закрывает фазу покупки.
(Метод \ct{fillCart} и другие отслеживают и вызывают нужные
экземпляры вложенных компонентов.
После того как подтвердили содержимое корзины,
вы не сможете вернуться обратно, не начиная новую сессию.
Во второй транзакции реализована оплата.
Можно перемещаться вперед и назад в пределах текущей транзакции,
до подтверждения оплаты.
Однако, как только покупка завершена, попытка вернуться обратно не удастся.

% Transactions may also be nested.
% A simple demonstration of this is found in the class \clsind{WANestedTransaction}.
% The first \ct{isolate:} takes as argument a block that contains another, nested
% \ct{isolate:}

Транзакции могут быть вложенными.
Демонстрация примера расположенна в классе \clsind{WANestedTransaction}.
В первом сообщении \ct{isolate:},
в аргументе блока расположенно вложенное \ct{isolate:}.

\begin{code}{}
WANestedTransaction>>>go
	self inform: 'Before parent txn'.
	self isolate:
			[self inform: 'Inside parent txn'.
			self isolate: [self inform: 'Inside child txn'].
			self inform: 'Outside child txn'].
	self inform: 'Outside parent txn'
\end{code}

% \dothis{Go to \url{http://localhost:8080/seaside/tests/alltests}, select
% \menu{WATransactionTest} and click on \button{Restart}.
% Try to navigate back and forth within the parent and child transaction by clicking the
% \button{back} button and then clicking \button{ok}.
% Note that as soon as a transaction is complete, you can no longer go back inside the
% transaction without generating an error upon clicking \button{ok}.}

\dothis{Перейдите по ссылке http://localhost:8080/seaside/tests/alltest,
выберите \menu{WATransactionTest} и нажмите кнопку \button{Restart}.
Попробуйте перейти вперед и обратно в пределах основной и вложенной
транзакции, нажимая кнопки \button{back} и \button{ok}.
Обратите внимание, что когда транзакция закрыта,
то попытка вернуться обратно, приведет к появлению сообщения об ошибке.}

%=================================================================
% \section{A complete tutorial example}

\section{Учебный пример}

% ON: Should take about two hours

% Let's see how we can build a complete Seaside application from scratch.\footnote{The
% exercise should take at most a couple of hours. If you prefer to just look at the
% completed source code, you can grab it from the SqueakSource project
% \url{http://www.squeaksource.com/PharoByExample}.
% The package to load is \scat{PBE-SeasideRPN}. The tutorial that follows uses slightly
% different class names so that you can compare your implementation with ours.}
% We will build a RPN (Reverse Polish Notation) calculator as a Seaside application that
% uses a simple stack machine as its underlying model.
% Furthermore, the Seaside interface will let us toggle between two displays\,---\,one
% which just shows us the current value on top of the stack, and the other which shows us
% the complete state of the stack.
% The calculator with the two display options is shown in \figref{stackMachine}.

Давайте посмотрим как мы можем построить целое приложение
с самого начала.
\footnote{Создание приложениия займент у нас максимум 2 часа.
Если вы предпочитаете просматривать исходный программный код,
в таком случае можете загрузить его с адреса:
\url{http://www.squeaksource.com/PharoByExample}.
Пакет называется \scat{PBE-SeasideRPN}.
Краткое руководство, которое размещено за названиями классов,
может помочь вам сравнивать свою реализацию с нашей.}
Мы создадим калькулятор использующий RPN (обратная польская запись),
на основе Seaside и модели простой стековой машины.
Кроме того, интерфейс позволит нам переключаться между
двумя режимами \,---\, в первом будет показываться значение
вершины стека, а во втором, полное состояние стека.

\begin{figure}[ht]
\begin{center}
\includegraphics[width=\textwidth]{stackMachine}
% \caption{RPN calculator and its stack machine}
\caption{RPN калькулятор и его стековая машина}
\figlabel{stackMachine}
\end{center}
\end{figure}

% We begin by implementing the stack machine and its tests.

Мы начнем с реализации стековой машины и ее тестов.

% \dothis{Define a new class called \ct{MyStackMachine} with an instance variable
% \ct{contents} initialized to a new \ct{OrderedCollection}.}

\dothis{Определите новый класс \ct{MyStackMachine} с переменной
экземпляра \ct{contents}, которая инициализированная новым
экземпляром \ct{OrderedCollection}.}

\begin{code}{}
MyStackMachine>>>initialize
	super initialize.
	contents := OrderedCollection new.
\end{code}

% The stack machine should provide operations to \ct{push:} and \ct{pop} values, view the
% \ct{top} of the stack, and perform various arithmetic operations to add, subtract,
% multiply and divide the top values on the stack.

Стековая машина будет поддерживать операции ввода (\ct{push:}) и
извлечения (\ct{pop}) значений, показывать верх стека,
выполнять различные арифметические операции (сложение, вычитание,
умножение, деление верхних значений стека.

% \dothis{Write some tests for the stack operations and then implement these operations.
% Here is a sample test:}

\dothis{Запишите несколько тестов для стековой операций и
проверьте их. Ниже показан пример теста.}

\needlines{4}
\begin{code}{}
MyStackMachineTest>>>testDiv
	stack
		push: 3;
		push: 4;
		div.
	self assert: stack size = 1.
	self assert: stack top = (4/3).
\end{code}

% You might consider using some helper methods for the arithmetic operations to check that
% there are two numbers on the stack before doing anything, and raising an error if this
% precondition is not fulfilled.\footnote{It's a good idea to use \ct{Object>>>assert:} to
% specify the preconditions for an operation.
% This method will raise an \ct{AssertionFailure} if the user tries to use the stack
% machine in an invalid state.}
% If you do this, most  of your methods will just be one or two lines long.

Вам не помешает включить несколько вспомогательных методов для
арифметических выражений, чтобы убедиться,
что в стеке имеется 2 числа.
\footnote{Хорошая идея использовать сообщение \ct{Object>>>assert:} для
определения правильности условий выполнения.
Этот метод создаст исключительную ситуацию Assertionfailure, если
пользователь попытается использовать стековую машину в недопустимом
состоянии.}
Если вы сделаете так, большинство методов будет иметь длину в 1 - 3 строки.


% You might also consider implementing \ct{MyStackMachine>>>printOn:} to make it easier to
% debug your stack machine implementation with the help of an object inspector.
% (Hint: just delegate printing to the \ct{contents} variable.)
% \index{Object!printOn:@\ct{printOn:}}

Также Вам следует рассмотреть реализацию метода
\ct{MyStackMachine>>>printOn:}, чтобы проще было отлаживать вашу
стековую машину при помощи объектного инспектора.
(Совет: перенаправляйте печать на переменную \ct{contents}.)
\index{Object!printOn:@\ct{printOn:}}


% \dothis{Complete the \ct{MyStackMachine} by writing operations \ct{dup} (push a duplicateof the top value onto the stack), \ct{exch} (exchange the top two values), and \ct{rotUp}(rotate the entire stack contents up\,---\,the top value will move to the bottom).}

\dothis{Завершите \ct{MyStackMachine} записью операций \ct{dup}
(добавив дубликат верхнего значения стека), \ct{exch} (обменяв два
верхних значения) и \ct{rotUp}(все содержимое стека провернув вверх\,---\,
верхнее значение будет перемещено вниз).}

% Now we have a simple stack machine implementation.
% We can start to implement the Seaside RPN Calculator.

Теперь мы имеем простую реализацию стековой машины.
А далее мы начнем создавать Seaside RPN Calculator.

% We will make use of 5 classes:
% \begin{itemize}
% \item \ct{MyRPNWidget}\,---\,this should be an abstract class that defines the common CSSstyle sheet for the application, and other common behavior for the components of the RPN
% calculator.
% It is a subclass of \ct{WAComponent} and the direct superclass of the following four
% classes.

Нам потребуется реализовать 5 новых классов.
\begin{itemize}
\item \ct{MyRPNWidget}\,---\,абстрактный класс в котором представлен общий
CSSstyle sheet (таблица каскадных стилей приложения), и другое общее поведение компонентов RPN calculator. Является подклассом \ct{WAComponent}
и суперклассом для последующих четырех классов.
  
% \item \ct{MyCalculator}\,---\,this is the root component.
% It should register the application (on the class side), it should instantiate and render
% its subcomponents, and it should register any state for backtracking.

\item \ct{MyCalculator}\,---\,основной (корневой) компонент. Регистрирует
приложение (на стороне класса), экземпляры которого прорисовывают
вложенные компоненты, также запоминает запоминает состояния
предыдущих страниц.

% \item \ct{MyKeypad}\,---\,this displays the keys that we use to interact with the
% calculator.

\item \ct{MyKeypad}\,---\,отображает кнопки калькулятора.

% \item \ct{MyDisplay}\,---\,this component displays the top of the stack and provides a
% button to call another component to display the detailed view.

\item \ct{MyKeypad}\,---\,показывает верх стека и имеет кнопку для
просмотра в подробном виде.

% \item \ct{MyDisplayStack}\,---\,this component shows the detailed view of the stack and
% provides a button to answer back.
%  It is a subclass of \lct{MyDisplay}.

\item \ct{MyDisplayStack}\,---\,подробное отображение стека и кнопка для
возрата в сокращенное состояние.
\end{itemize}

% \dothis{Define \ct{MyRPNWidget} in the category \ct{MyCalculator}.
% Define the common \ct{style} for the application.}

\dothis{Определите класс \ct{MyRPNWidget} в категорию \ct{MyCalculator}.
Далее создайте общий стиль для приложения.}

% Here is a minimal CSS for the application.
% You can make it more fancy if you like.

Ниже представлен минимальный CSS для приложения. Вы можете сделать
более причудливее и красивее, так как Вам нравится.

\begin{code}{}
MyRPNWidget>>>style
	^ 'table.keypad { float: left; }
td.key {
	border: 1px solid grey;
	background: lightgrey;
	padding: 4px;
	text-align: center;
}
table.stack { float: left; }
td.stackcell {
	border: 2px solid white;
	border-left-color: grey;
	border-right-color: grey;
	border-bottom-color: grey;
	padding: 4px;
	text-align: right;
}
td.small { font-size: 8pt; }'
\end{code}

% \dothis{Define \ct{MyCalculator} to be a root component and register itself as an
% application (\ie implement \ct{canBeRoot} and \ct{initialize} on the class side).
% Implement \ct{MyCalculator>>>renderContentOn:} to render something trivial (such as its
% name), and verify that the application runs in a browser.
% }

\dothis{Следующим шагом определите \ct{MyCalculator}, являющийся
главным компонентом, потом зарегистрируйте как приложение
(предварительно реализовав методы \ct{canBeRoot} и \ct{initialize} на
стороне класса). Запишите метод \ct{MyCalculator>>>renderContentOn:} и
проверьте как приложение работает в браузере.}

% \ct{MyCalculator} is responsible for instantiating \ct{MyStackMachine}, \ct{MyKeypad} and\ct{MyDisplay}.

\ct{MyCalculator} ответит созданием экземпляров \ct{MyStackMachine},
\ct{MyCalculator} и \ct{MyDisplay}.

% \dothis{
% Define \ct{MyKeypad} and \ct{MyDisplay} as subclasses of \lct{MyRPNWidget}.
% All three components will need access to a common instance of the stack machine, so
% define the instance variable \ct{stackMachine} and an initialization method
% \ct{setMyStackMachine:} in the common parent, \ct{MyRPNWidget}.
% Add instance variables \ct{keypad} and \ct{display} to \ct{MyCalculator} and initialize
% them in \ct{MyCalculator>>>initialize}.
% (Don't forget to send \lct{super initialize}!)}

\dothis{Теперь определите класс \ct{MyKeypad} как подкласс \lct{MyRPNWidget}.
Всем трем компонентам нужен будет доступ к общему экземпляру стековой
машины, так определим ее как переменную экземпляра \ct{stackMachine}
и метод инициализации \ct{setStackMachine:} в общем суперклассе
\ct{MyRPNWidget}. Добавьте переменные экземпляров \ct{keypad} и
\ct{display} в \ct{MyCalculator} и инициализируйте их в
\ct{MyCalculator>>>initialize}.
(Не забудьте послать сообщение \lct{super initialize}!)}

% \dothis{
% Pass the shared instance of the stack machine to the keypad and the display in the same
% initialize method.
% Implement \ct{MyCalculator>>>renderContentOn:} to simply render in turn the keypad and
% the display.
% To correctly display the subcomponents, you must implement \ct{MyCalculator>>>children}
% to return an array with the keypad and the display.
% Implement placeholder rendering methods for the keypad and the display and verify that
% the calculator now displays its two subcomponents.}

\dothis{Pass the shared instance of the stack machine to the keypad and the display in the same initialize method
Реализуйте метод \ct{MyCalculator>>>renderContentOn:}, чтобы просто
прорисовывать, в свою очередь, keypad и display.
Для корректного отображения вложенных компонентов, Вам потребуется
реализовать \ct{Mycalculator>>>children}, который будет возвращать
keypad и display и проверять чтобы калькулятор возвращал эти два
компонента}

%\ab{Too long!}

% Now we will change the implementation of the display to show the top value of the stack.

Сейчас мы изменим реализацию display, которое показывает
верхнее значение стека.

% \dothis{
% Use a table with class ``keypad'' containing a row with a single table data cell with
% class ``stackcell''.
% Change the rendering method of the keypad to ensure that the number 0 is pushed on the
% stack in case it is empty.
% (Define and use \ct{MyKeypad>>>ensureMyStackMachineNotEmpty}.)
% Also make it display an empty table with class ``keypad''.
% Now the calculator should display a single cell containing the value 0.
% If you toggle the halos, you should see something like this:}

\dothis{Используйте таблицу класса <<keypad>> содержащую одиночную
табличную ячейку класса <<stackcell>>.
Измените метод отображения клавиатуры для того, чтобы изображалось
число 0 в стеке, если он пуст.
(Определите и измените метод
\ct{MyKeypad>>>ensureMyStackMachineNotEmpty}.)
Теперь калькулятор сможет показывать одиночную
ячейку содержащую значение 0.
Если Вы переключите на режим halos, то увидите что-то вроде:}

\begin{figure}[ht]
\begin{center}
\includegraphics[width=0.8\textwidth]{firstStackDisplay}
\caption{Displaying the top of the stack}
\figlabel{firstStackDisplay}
\end{center}
\end{figure}

% Now let's implement an interface to interact with the stack.

Сейчас давайте определим интерфейс взаимодействия со стеком.

% \dothis{
% First define the following helper methods, which will make it easier to script the
% interface:}

\dothis{Сначала определите вспомогательные методы, которые упростят
программный код интерфейса}

\needlines{3}
\begin{code}{}
MyKeypad>>>renderStackButton: text callback: aBlock colSpan: anInteger on: html 
	html tableData
		class: 'key';
		colSpan: anInteger;
		with: 
				[html anchor
					callback: aBlock;
					with: [html html: text]]
\end{code}


\begin{code}{}
MyKeypad>>>renderStackButton: text callback: aBlock on: html 
	self 
		renderStackButton: text
		callback: aBlock
		colSpan: 1
		on: html
\end{code}

% We will use these two methods to define the buttons on the keypad with appropriate
% callbacks.
% Certain buttons may span multiple columns, but the default is to occupy just one column.

Мы будем использовать эти два метода, чтобы определить кнопки на
клавиатуре с соответствующими блоками обратного вызова.
Некоторые кнопки могут располагаться в нескольких колонках, но по
умолчанию определены для одной одной колонки.

% \dothis{
% Use the two helper methods to script the keypad as follows:
% (Hint: start by getting the digit and ``Enter'' keys working, then the arithmetic
% operators.)}

\dothis{Используйте два вспомогательных метода, чтобы запрограммировать
клавиатуру как в коде:
(Совет: начните сначала с цифр и кнопки <<Enter>>, затем арифметические
операторы.)}

\needlines{4}
\begin{code}{}
MyKeypad>>>renderContentOn: html 
  self ensureStackMachineNotEmpty.
  html table
    class: 'keypad';
    with: [
      html tableRow: [
          self renderStackButton: '+' callback: [self stackOp: #add] on: html.
          self renderStackButton: '&ndash;' callback: [self stackOp: #min] on: html.
          self renderStackButton: '&times;' callback: [self stackOp: #mul] on: html.
          self renderStackButton: '&divide;' callback: [self stackOp: #div] on: html.
          self renderStackButton: '&plusmn;' callback: [self stackOp: #neg] on: html ].
        html tableRow: [
          self renderStackButton: '1' callback: [self type: '1'] on: html.
          self renderStackButton: '2' callback: [self type: '2'] on: html.
          self renderStackButton: '3' callback: [self type: '3'] on: html.
          self renderStackButton: 'Drop' callback: [self stackOp: #pop]
          	colSpan: 2 on: html ].
" and so on ... "
        html tableRow: [
          self renderStackButton: '0' callback: [self type: '0'] colSpan: 2 on: html.
          self renderStackButton: 'C' callback: [self stackClearTop] on: html.
          self renderStackButton: 'Enter'
          	callback: [self stackOp: #dup. self setClearMode]
			colSpan: 2 on: html ]]
\end{code}

% Check that the keypad displays properly.
% If you try to click on the keys, however, you will find that the calculator does not workyet ...

Проверьте чтобы клавиатура отображалась правильно.
Вы можете попробовать понажимать на клавиши, однако, Вы заметите,
что калькулятор не работает...

% \dothis{
% Implement \ct{MyKeypad>>>type:} to update the top of the stack by appending the typed
% digit.
% You will need to convert the top value to a string, update it, and convert it back to an
% integer, something like this:}

\dothis{Добавьте метод \ct{MyKeypad>>>type:}, чтобы обновлять верх стека
при нажатии на цифровые клавиши.
Вам потребуется конвертировать верхнее значение в строковой объект,
обновить, и конвертировать обратно в целочисленное, что-то вроде этого:}

\begin{code}{}
MyKeypad>>>type: aString
	stackMachine push: (stackMachine pop asString, aString) asNumber.
\end{code}

% Now when you click on the digit keys the display should be updated.
% (Be sure that \ct{MyStackMachine>>>pop} returns the value popped, or this will not work!)

Теперь когда Вы нажмете цифровую кнопку, стек отобразится обновленным.
(Будьте уверены, что метод \ct{MyStackMachine>>>pop} вернет верхнее
значение стека)

% \dothis{Now we must implement \ct{MyKeypad>>>stackOp:}
% Something like this will do the trick:}

\dothis{Далее нам потребуется создать метод \ct{MyKeypad>>>stackOp:}
Нечто подобное как нижеследующий код:}

\begin{code}{}
MyKeypad>>>stackOp: op
	[ stackMachine perform: op ] on: AssertionFailure do: [ ].
\end{code}

% The point is that we are not sure that all operations will succeed, for example, additionwill fail if we do not have two numbers on the stack.
% For the moment we can just ignore such errors.
% If we are feeling more ambitious later on, we can provide some user feedback in the errorhandler block.

Дело в том, что мы не уверены, что все операции будут успешны, например,
сложение будет ошибочным, если в стеке нет двух чисел.
На текущий момент мы пока будет игнорировать такие ошибки.
Если же мы считаем себя более амбициозными, то можем добавить код
перехватывающий ошибки.

% \dothis{The first version of the calculator should be working now.
% Try to enter some numbers by pressing the digit keys, hitting \menu{Enter} to push a copyof the current value, and entering \menu{+} to sum the top two values.}

\dothis{Первая версия калькулятора должна заработать сейчас.
Попробуйте ввести несколько чисел, нажимая на цифровые кнопки. Кнопка
\menu{Enter} позволяет добавить в стек текущее значение, а нажатие кнопки
\menu{+} приведет к сложению стека и текущего значения.}

% You will notice that typing digits does not behave the way you might expect.
% Actually the calculator should be aware of whether you are typing a \emph{new} number, orappending to an existing number.

Вы может обратить внимание, что ввод цифр не ведет себя так,
как вы могли ожидать. На самом деле калькулятор должен знать, что Вы
вводите новое число, добавляя к уже существующему числу.


% \dothis{Adapt \ct{MyKeypad>>>type:} to behave differently depending on the current typingmode.
% Introduce an instance variable \ct{mode} which takes on one of the three values
% \lct{typing} (when you are typing), \lct{push} (after you you have performed a calculatoroperation and typing should force the top value to be pushed), or \lct{clear} (after you
% have performed \menu{Enter} and the top value should be cleared before typing).
% The new \ct{type:} method might look like this: }

\dothis{Адаптируйте метод \ct{MyKeypad>>>type:}, чтобы он вел себя
по разному в зависимости от текущего режима ввода.
Добавьте новую переменную экземпляра \ct{mode}, которая будет принимать
одно из трех значений: \lct{typing} (когда Вы печатаете), \lct{push} (после
того как Вы сформировали необходимую операцию калькулятора), или
\lct{clear} (после того как Вы нажали \menu{enter} и верхнее значение будет
очищено). Новый метод \ct{type:} может выглядеть как:
}

\begin{code}{}
MyKeypad>>>type: aString
	self inPushMode ifTrue: [
		stackMachine push: stackMachine top.
		self stackClearTop ].
	self inClearMode ifTrue: [ self stackClearTop ].
	stackMachine push: (stackMachine pop asString, aString) asNumber.
\end{code}

% Typing might work better now, but it is still frustrating not to be able to see what is
% on the stack.

Ввод стал работать лучше, но все равно расстраивает отсутствие
возможности видеть, что в стеке.

% \dothis{
% Define \ct{MyDisplayStack} as a subclass of \ct{MyDisplay}.
% Add a button to the rendering method of \ct{MyDisplay} which will call a new instance of
% \ct{MyDisplayStack}.
% You will need an html anchor that looks something like this: }

\dothis{Создайте новый класс \ct{MyDisplayStack} как подкласс \ct{MyDisplay}.
Добавьте кнопку в метод прорисовки \ct{MyDisplay}, который будет вызывать
новый экземпляр \ct{MyDisplayStack}.
Вам потребуется html-якорь, который похож на:}

\begin{code}{}
html anchor
	callback: [ self call: (MyDisplayStack new setMyStackMachine: stackMachine)];
	with: 'open'
\end{code}

% The callback will cause the current instance of \ct{MyDisplay} to be temporarily replacedby a new instance of \ct{MyDisplayStack} whose job it is to display the complete stack.
% When this component signals that it is done (\ie by sending \ct{self answer}), then
% control will return to the original instance of \ct{MyDisplay}.

Обратный вызов приведет к текущему экземпляру класса \ct{MyDisplay},
который будет временно заменен новым экземпляром \ct{MyDisplayStack},
задача у которого отобразить весь стек.
Когда этот компонент ответит, что все сделано (т.е. отправкой
сообщения \ct{self answer}), в таком случае управление вернется к
\ct{MyDisplay}.

% \dothis{
% Define the rendering method of \ct{MyDisplayStack} to display all of the values on the
% stack.
% (You will either need to define an accessor for the stack machine's \ct{contents} or you
% can define \ct{MyStackMachine>>>do:} to iterate over the stack values.)
% The stack display should also have a button labelled ``close'' whose callback will simplyperform \ct{self answer}. }

\dothis{Определите прорисовывающий метод \ct{MyDisplayStack},
отображающий все значения стека.
(Вам нужно будет создать методы доступа к содержимому стековой машины
или Вы можете определить \ct{MyStackMachine>>>do:}, и в
итерационном цикле получить доступ к стеку.}

\begin{code}{}
html anchor
	callback: [ self answer];
	with: 'close'
\end{code}

% Now you should be able to \emph{open} and \emph{close} the stack while you are using the
% calculator.

На следующем этапе потребуется возможность открытия и закрытия стека,
когда Вы используете калькулятор.

% There is, however, one thing we have forgotten.
% Try to perform some operations on the stack.
% Now use the ``back'' button of your browser and try to perform some more stack
% operations.
% (For example, \menu{open} the stack, type \menu{1}, \menu{Enter} twice and \menu {+}.
% The stack should display ``2'' and ``1''.
% Now hit the ``back'' button.
% The stack now shows three times ``1'' again.
% Now if you type \menu{+} the stack shows ``3''.
% Backtracking is not yet working.

Существует, однако, одна вещь о которой мы забыли.
Попробуйте выполнить несколько операций со стеком.
Далее, используя кнопку <<назад>> браузера, выполните
предыдущие операции со стеком.
(Например, \menu{open} (откройте) стек, напечатайте \menu{1},
\menu{Enter} дважды
и \menu{+}). Стек покажет <<2>> и <<1>>. Далее нажмем кнопку
<<назад>>. И стек покажет 3 раза <<1>>. Если же Вы выполните \menu{+},
то стек отобразит <<3>>. Предыдущие страницы неправильно
отображаются.

% \dothis{
% Implement \ct{MyCalculator>>>states} to return the contents of the stack machine.
% Check that backtracking now works correctly! }

\dothis{Добавив метод \ct{MyCalculator>>>states}, возвращающий стековое
содержимое. И просмотрев предыдущие страницы, Вы обнаружите, что все
работает правильно!}

% Sit back and enjoy a tall glass of something cool!

Устройтесь поудобнее и наслаждайтесь!

%=================================================================
% \section{A quick look at AJAX}

\section{Краткий обзор AJAX}

% Original text by Lukas Renggli

% \ind{AJAX} (Asynchronous \ind{JavaScript} and \ind{XML}) is a technique to make web
% applications more interactive by exploiting JavaScript functionality on the client side.

\ind{AJAX} (Asynchronous \ind{JavaScript} and \ind{XML})\,---\,технология
делающая веб-страницы более интерактивными, используя
функциональность JavaScript на стороне клиента.

% Two well-known JavaScript libraries are \ind{Prototype}
% (\url{http://www.prototypejs.org}) and \ind{script.aculo.us}
% (\url{http://script.aculo.us}).
% Prototype provides a framework to ease writing JavaScript.
% script.aculo.us provides some additional features to support animations and drag-and-dropon top of Prototype.
% Both frameworks are supported in Seaside through the package ``Scriptaculous''.

Наиболее известны и распространены две JavaScript библиотеки \,---\,
Prototype (\url{http://www.prototypejs.org}) и script.aculo.us
(\url{http://script.aculo.us}).
Prototype\,---\,фреймворк для упрощения написания на JavaScript.
script.aculo.us поддерживает дополнительно анимацию и перетаскивание
элементов (drag-and-dropen) на основе Prototype. Оба фреймворка
подрерживаются Seaside и расположены в пакете <<Scriptaculous>>.

% All ready-made images have the Scriptaculous package extensions already loaded.
% The latest version is available from \url{http://www.squeaksource.com/Seaside}.
% An online demo is available at \url{http://scriptaculous.seasidehosting.st}.
% Alternatively, if you have a enabled image running, simply go to
% \url{http://localhost:8080/seaside/tests/scriptaculous}.

All ready-made images have the Scriptaculous package extensions already loaded.
Последняя версия доступна на \url{http://www.squeaksource.com/Seaside}.
Онлайн демонстрации доступны на \url{http://scriptaculous.seasidehosting.st}.
В качестве альтернативы можете использовать исполняемый образ,
просто перейдя на \url{http://localhost:8080/seaside/tests/scriptaculous}.

% The Scriptaculous extensions follow the same approach as Seaside itself\,---\,simply
% configure Smalltalk objects to model your application, and the needed Javascript code
% will be generated for you.

Расширения Scrptaculous используют такой-же простой подход как и
Seaside\,---\,простое конфигурирование объектов в модель вашего приложения,
а JavaScript код генерируется автоматически.

% Let us look at a simple example of how client-side Javascript support can make our RPN
% calculator behave more naturally.
% Currently every keystroke to enter a digit generates a request to refresh the page.
% We would like instead to handle editing of the display on the client-side by updating thedisplay in the existing page.

Давайте рассмотрим простой пример, как на стороне клиена JavaScript может
сделать калькулятор более натуральным. В настоящее время нажатие каждой
клавиши приводит к обновлению всей страницы. We would like instead to handle editing of the display on the client-side by updating thedisplay in the existing page.

% \dothis{To address the display from JavaScript code we must first give it a unique id.
% Update the calculator's rendering method as follows:\footnote{If you have not implementedthe tutorial example yourself, you can simply load the complete example (PBE-SeasideRPN)
% from \url{http://www.squeaksource.com/PharoByExample} and apply the suggested changes to
% the classes \ct{RPN*} instead of \ct{My*}.}}

\dothis{Чтобы ссылаться на display из JavaScript-кода, нам нужно получить
уникальный id. Обновите метод визуализации калькулятора как показанно 
ниже:\footnote{Если у вас не получается реализовать пример самостоятельно,
Вы можете просто загрузить готовый пример (PBE-SeasideRPN) из
\url{http://www.squeaksource.com/PharoByExample} и применить изменения у 
классов \ct{RPN*} вместо \ct{My*}.}}

\begin{code}{}
MyCalculator>>>renderContentOn: html
	html div id: 'keypad'; with: keypad.
	html div id: 'display'; with: display.	
\end{code}
				
% \dothis{To be able to re-render the display when a keyboard button is pressed, the
% keyboard needs to know the display component.
% Add a \ct{display} instance variable to \ct{MyKeypad}, an initialize method
% \ct{MyKeypad>>>setDisplay:}, and call this from \ct{MyCalculator>>initialize}.
% Now we are able to assign some JavaScript code to the buttons by updating
% \ct{MyKeypad>>>renderStackButton:callback:colSpan:on:} as follows:}

\dothis{Чтобы была возможность перерисовать display,
когда кнопка будет нажата, keyboard нужна ссылка на компонент display.
Добавьте переменную экзепляра \ct{display} в \ct{MyKeypad}, а метод инициализации \ct{MyKeypad>>>setDisplay:} вызовите из
\ct{MyCalculator>>>initialize}. Теперь мы имеем возможность прикреплять
JavaScript-код к кнопкам и обновлять через метод
\ct{MyKeypad>>>renderStackButton:callback:colSpan:on:}, как показано ниже:}

\begin{code}{}
MyKeypad>>>renderStackButton: text callback: aBlock colSpan: anInteger on: html 
	html tableData
		class: 'key';
		colSpan: anInteger;
		with: [
			html anchor
				callback: aBlock;
				onClick:				"handle Javascript event"
					(html updater
						id: 'display';
						callback: [ :r |
							aBlock value.
							r render: display ];
						return: false);
				with: [ html html: text ] ]
\end{code}

% \mthind{WATagBrush}{onClick:} specifies a \ind{JavaScript} event handler.
% \ct{html updater} returns an instance of \ct{SUUpdater}, a Smalltalk object representing
% the JavaScript Ajax.Updater object (\url{http://www.prototypejs.org/api/ajax/updater}).
% This object performs an AJAX request and updates a container's contents based on the
% response text.
% \ct{id:} tells the updater what XHTML DOM element to update, in this case the contents ofthe div element with the id 'display'.
% \ct{callback:} specifies a block that is triggered when the user presses the button.
% The block argument is a new renderer \ct{r}, which we can use to render the display
% component.
% (Note: Even though html is still accessible, it is not valid anymore at the time this
% callback block is evaluated).
%Before rendering the display component we evaluate \ct{aBlock} to perform the desired
% action.

\mthind{WATagBrush}{onClick:} специфицирует обработчик события JavaScript.
\ct{html updater} возвращает экземпляр \ct{SUUpdater}, Smalltalk-объект
представляющий JavaScript Ajax.Updater
(\url{http://www.prototypejs.org/api/ajax/updater}). Этот объект формирует
AJAX-запрос и обновляет содержимое контейнера.
\ct{id:} говорит об обновлении нужного XHTML DOM-элемента, в нашем случае,
содержимое div-элемента с id 'display'.
\ct{callback:} специфицирует блок, который выполняется когда пользователь
нажмет кнопку. В качестве аргумента блока выступает новая часть страницы,
используя которую, можем обновить компонент на стороне клиента.
(Заметка: Хотя html-страница доступна, но уже будет не действительна на
момент выполнения блока).
После отображения компонента будет выполнен \ct{aBlock},
чтобы сформировать желаемое действие.

% \ct{return: false} tells the JavaScript engine to not trigger the original link callback,which would cause a full refresh.
% We could instead remove the original anchor \ct{callback:}, but like this the calculator
% will still work even if JavaScript is disabled.

\ct{return: false} говорит движку JavaScript, что не надо запускать
оригинальную ссылку блока, которая приведет к полному обновлению.
Мы могли бы удалить оригинальный якорь \ct{callback:}, но в таком случае
калькулятор не будет работать при отключенном JavaScript.

% \dothis{Try the calculator again, and notice how a full page refresh is triggered every
% time you press a digit key. (The URL of the web page is updated at each keystroke.)}

\dothis{Испытайте калькулятор снова, и обратите внимание как обновление
страницы запускается каждый раз, когда Вы нажимаете цифровую кнопку.
(URL страницы тоже изменяется.)}

% Although we have implemented the client-side behavior, we have not yet activated it.
% Now we will enable the Javascript event handling.

Хотя мы реализовали поведение на стороне клиента, нам обязательно нужна
активизация. А для этого требуется включить управление
JavaScript-событиями.

% \dothis{
% Click on the \link{Configure} link in the toolbar of the calculator.
% Select ``Add Library:'' \ct{SULibrary}, click the \button{Add} button and
% \button{Close}.}

\dothis{Выберите ссылку \link{Configure} на панели инструментов калькулятора.
Далее <<Add Library:>> \ct{SULibrary}, нажмите \button{Add} и \button{Close}.}

%Instead of manually adding the library, you may also do it programmatically when you
% register the application:

Вместо ручного добавления библиотеки, можно выполнить программно,
когда Вы регистрируете приложение:
\begin{code}{}
MyCalculator class>>>initialize
	(self registerAsApplication: 'rpn')
		addLibrary: SULibrary}}
\end{code}

\begin{figure}[ht]
\begin{center}
\includegraphics[width=\textwidth]{ajax-processing}
\caption{Seaside AJAX processing (simplified)}
\figlabel{ajax-processing}
\end{center}
\end{figure}

% \dothis{Try the revised application. Note that the feedback is much more natural. In
% particular, a new URL is not generated with each keystroke.}

\dothis{Попробуйте исправленное приложение. Заметьте что теперь все
более натурально. В частности, новый URL страницы не генерируется, при
каждом нажатии кнопок.}

% You may well ask, \emph{yes, but how does this work?}
% \figref{ajax-processing} shows how the RPN applications would both without and with
% AJAX.Basically AJAX short-circuits the rendering to \emph{only} update the display
% component.
% Javascript is responsible both for triggering the request and updating the corresponding
% DOM element.
% Have a look at the generated source-code, especially the JavaScript code:

Вы можете к тому-же спросить, \emph{да, но как это работает?}
\figref{ajax-processing} показывает как RPN-приложение взаимодействует с
AJAX и без него. В основе AJAX реализованы короткие замыкания, которые
обновляют только отображаемый компонент. JavaScript работает в два
направления: отправка запроса и отображение DOM-элемента. Ниже
представлен пример сгенерированного кода страницы, точнее JavaScript кода:

\begin{code}{}
new Ajax.Updater(
	'display',
	'http://localhost/seaside/RPN+Calculator',
	{'evalScripts': true,
'parameters': ['UNDERSCOREs=zcdqfonqwbeYzkza',
'UNDERSCOREk=jMORHtqr','9'].join('&')});return false
\end{code}

%For more advanced examples, have a further look at
% \url{http://localhost:8080/seaside/tests/scriptaculous}.

Для просмотра дополнительных примеров откройте на
\url{http://localhost:8080/seaside/tests/scriptaculous/}.

% \paragraph{\emph{Hints.}}
\paragraph{\emph{Советы.}}
% In case of server side problems use the Smalltalk debugger.
% In case of client side problems use FireFox (\url{http://www.mozilla.com}) with the
% JavaScript debugger FireBug (\url{http://www.getfirebug.com/}) plugin enabled.

В случае возникновения проблем на стороне сервера используйте
Smalltalk-отладчик. А при возникновении проблем на стороне клиента
используйте Firefox (\url{http://www.mozilla.ru/}) с FireBug (JavaScript-отладчик
\url{http://www.getfirebug.com/}). 

%=================================================================
% \section{Chapter summary}

\section{Краткий обзор главы}

\begin{itemize}
% \item The easiest way to get started is to download the ``Seaside One-Click Experience''
% from \url{http://seaside.st}
\item Самый простой способ начать\,---\,это загрузить <<Seaside One-Click
Experience>> на \url{http://seaside.st/} 
% \item Turn the server on and off by evaluating \ct{WAKom startOn: 8080} and \ct{WAKom stop}.
\item Запустить (остановить) сервер можно выполнив:
\ct{WAKom startOn: 8080} и \ct{WAKom stop}.
% \item Reset the administrator login and password by evaluating \ct{WADispatcherEditor initialize}.
\item Логин и пароль администратора сбрасываются после выполнения 
\ct{WADispatcherEditor initialize}
% \item \menu{Toggle Halos} to directly view application source code, run-time objects, CSSand XHTML.
\item \menu{Toggle Halos} переключает приложение в режим просмотра
кода, объектов, CSS и XHTML.
% \item Send \ct{WAGlobalConfiguration setDeploymentMode} to hide the toolbar.
\item Посылка сообщения \ct{WAGlobalConfiguration>>>setDeploymentMode}
скрывает панель инструментов.
% \item Seaside web applications are composed of components, each of which is an instance
% of a subclass of \ct{WAComponent}.
\item Веб-приложение Seaside представляет собой композицию компонентов,
где каждый является экземпляром подкласса \ct{WAComponent}.
% \item Only a root component may be registered as a component. It should implement
% \ct{canBeRoot} on the class side. Alternatively it may register itself as an application
% in its class-side \ct{initialize} method by sending \ct{self registerAsApplication:}
% \emph{application path}.
% If you override \ct{description} it is possible to return a descriptive application name
% that will be displayed in the configuration editor.
\item Только корневой элемент может быть зарегистрирован в качестве
компонента. Также у него потребуется реализовать метод \ct{canBeRoot}
на стороне класса. В качестве альтернативы можно корневой компонент
зарегистрировать, послав сообщение
\ct{self registerAsApplication:} \emph{anApplicationPath}.
Переопределив метод \ct{description} можно изменить описание приложения
в редакторе конфигурации.
% \item To backtrack state, a component must implement the \ct{states} method to answer an
% array of objects whose state will be restored if the user clicks the browser's ``back''
% button.
\item Для правильного сохранения предыдущей страницы, в компоненте
должен быть переопределен метод \ct{states}, возвращающий массив
объектов, которые отобразятся когда пользователь нажмет в браузере
<<назад>>.
%\item A component renders itself by implementing \ct{renderContentOn:}.
% The argument to this method is an XHTML rendering \emph{canvas} (usually called
% \ct{html}).
\item Компонент отображает себя через метод \ct{renderContentOn:}.
В качестве аргумента выступает XHTML-страница
(обычно называемая \ct{html}).
% \item A component can render a subcomponent by sending \ct{self render:}
% \emph{subcomponent}.
\item Компонент может отобразить вложенный элемент посылкой сообщения
\ct{self render:anSubelement}
% \item XHTML is generated programmatically by sending messages to \emph{brushes}. A brush
% is obtained by sending a message, such as \ct{paragraph} or \ct{div}, to the html canvas.
\item XHTML генерируется программно посылкой сообщений специальным
объектам (веб-кисти). Указатель на кисть можно получить отправив
сообщение \ct{paragraph}, \ct{div} и т.д. html-странице
% \item If you send a cascade of messages to a brush that includes the message \ct{with:},
% then \ct{with:} should be the last message sent.
% Thw \ct{with:} message sets the contents \emph{and} renders the result.
\item Если Вы посылаете каскадные сообщения кисти, тогда последним
сообщение должно быть \ct{with:}
% \item Actions should appear only in callbacks.
% You should not change the state of the application while you are rendering it.
\item Любые действия должны быть размещены в блоках обратного вызова.
Вам не нужно изменять состояние приложения, когда оно прорисовывается на
веб-странице.
% \item You can bind various form widgets and anchors to instance variables with accessors
% by sending the message \ct{on:} \emph{instance variable} \ct{of:} \emph{object} to the brush.
\item Вы можете связять различные виджеты и якоря с переменными
экземпляра через методы доступа, отправив кисти (brush) сообщение \ct{on:}
\emph{instance variable} \ct{of:} \emph{object}
% \item You can define the CSS for a component hierarchy by defining the method \ct{style},which should return a string containing the style sheet.
% (For deployed applications, it is more usual to refer to a style sheet located at a
% static URL.)
\item Вы можете определить CSS для компонента переопределив метод
\ct{style}, который будет возвращать строковой объект, содержащий таблицу
стилей.
% \item Control flows can be programmed by sending \ct{x call: y}, in which case component
% \ct{x} will be replaced by \ct{y} until \ct{y} answers by sending \ct{answer:} with a
% result in a callback.
% The receiver of \ct{call:} is usually \ct{self}, but may in general be any visible
% component.
\item Управление потоками может быть программно реализовано посылкой
сообщения \ct{x call: y}, где объект-x заменяется на объект-y до тех пор
пока объект-y не отравит сам себе \ct{answer:}, с результатом
размещенном в блоке обратного вызова.
% \item A control flow can also be specified as a \emph{task}\,---\,a instance of a
% subclass of \ct{WATask}. It should implement the method \ct{go}, which should \ct{call:}
% a series of components in a workflow.
\item Управление потоками может быть специфицировано
в форме задачи\,---\,
экземпляр подкласса \ct{WATask}. Тогда следует переопределить метод
\ct{go}, который посылает \ct{call:} серии компонентов.
% \item Use \ct{WAComponents}'s convenience methods \ct{request:}, \ct{inform:},
% \ct{confirm:} and \ct{chooseFrom:caption:} for basic interactions.
\item Используйте методы \ct{WAComponents}: \ct{request}, \ct{inform:},
\ct{confirm:} и \ct{chooseFrom:caption:} для создания базовых форм
взаимодействия с пользователем.
% \item To prevent the user from using the browser's ``back'' button to access a previous
% execution state of the web application, you can declare portions of the workflow to be a
% \emph{transaction} by enclosing them in an \ct{isolate:} block.
\item Чтобы защитить данные в формах пользователя при использовании
кнопки браузера <<назад>>, Вы можете отметить часть рабочего потока как
транзакция, поместив в блок \ct{isolate:}.
\end{itemize}
%-----------------------------------------------------------------

%=================================================================
\ifx\wholebook\relax\else 
   \bibliographystyle{jurabib}
   \nobibliography{scg}
   \end{document}
\fi
%=================================================================